########################################
# Events for Touhou Diplomacy
########################################

namespace = th_diplo_events

###MHG DIPLO ACTIONS###
#Provoke War
country_event = {
    id = th_diplo_events.1
	title = th_diplo_events.1.t
	desc = th_diplo_events.1.desc
	picture = SPY_eventPicture

    is_triggered_only = yes

    immediate = {
        hidden_effect = {
            random_country = {
                limit = {
                    has_country_flag = th_is_planned_aggressor_of_@ROOT
                }
                save_event_target_as = planned_aggressor
            }
        }
    }

    after = {
        event_target:planned_aggressor = {
            clr_country_flag = th_is_planned_aggressor_of_@ROOT
        }
        clr_country_flag = th_has_already_a_planned_aggressor
    }

    option = {  #Excellent
        name = th_diplo_events.1.a
        hidden_effect = {
            event_target:planned_aggressor = {
                country_event = {
                    id = th_diplo_events.2
                    days = 1
                }
            }
        }
    }
}

#Aggressor gets order to declare war
country_event = {
    id = th_diplo_events.2
	title = th_diplo_events.2.t
	desc = th_diplo_events.2.desc
    picture = DIPLOMACY_eventPicture
    
    major = yes

    is_triggered_only = yes

    immediate = {
        hidden_effect = {
            random_country = {
                limit = {
                    has_country_flag = th_target_for_planned_war
                }
                save_event_target_as = planned_target
            }
        }
    }

    after = {
        event_target:planned_target = {
            clr_country_flag = th_target_for_planned_war
        }
    }

    option = {  #To War!
        name = th_diplo_events.2.a
        trigger = {
            event_target:planned_target = {
                exists = yes
            }
            is_free_or_tributary_trigger = yes
        }
        declare_war_with_cb = {
            casus_belli = cb_insult
            who = event_target:planned_target            
        }

        ai_chance = {
            factor = 100
            modifier = {
                factor = 0
                was_player = yes
            }
            modifier = {
                factor = 0
                event_target:planned_target = {
                    was_player = yes
                }
            }
            modifier = {
                factor = 0
                event_target:planned_target = {
                    ai = no
                }
            }
        }
    }

    option = {  #We got tricked!
        name = th_diplo_events.2.b
        trigger = {
            OR = {
                event_target:planned_target = {
                    exists = no
                }                
                is_free_or_tributary_trigger = no
            }
        }
        add_prestige = -25
        add_stability = -1

        ai_chance = {
            factor = 100
            modifier = {
                factor = 0
                was_player = yes
            }
        }
    }

    option = {  #There is something wrong...
        name = th_diplo_events.2.c

        ai_chance = {
            factor = 0
            modifier = {
                factor = 100
                was_player = yes
            }
            modifier = {
                factor = 100
                event_target:planned_target = {
                    was_player = yes
                }
            }
            modifier = {
                factor = 100
                event_target:planned_target = {
                    ai = no
                }
            }
        }
    }
}

#Clear flag for aggressor
country_event = {
    id = th_diplo_events.3
	title = th_diplo_events.3.t
	desc = th_diplo_events.3.desc
	picture = SPY_eventPicture

    is_triggered_only = yes
    trigger = {
        has_country_flag = th_has_already_a_planned_aggressor
        NOT = {
            calc_true_if = {
                all_country = {
                    has_country_flag = th_is_planned_aggressor_of_@ROOT
                }
                amount = 1
            }
        }
    }

    hidden = yes

    option = {
        name = th_diplo_events.3.a
        clr_country_flag = th_has_already_a_planned_aggressor

        ai_chance = {
            factor = 100
        }
    }
}

#Clear flag if country is no longer able to be an aggressor
country_event = {
    id = th_diplo_events.4
	title = th_diplo_events.4.t
	desc = th_diplo_events.4.desc
	picture = SPY_eventPicture
    is_triggered_only = yes
    trigger = {
        has_country_flag = th_has_already_a_planned_aggressor
        calc_true_if = {
            all_country = {
                has_country_flag = th_is_planned_aggressor_of_@ROOT
                is_free_or_tributary_trigger = no
            }
            amount = 1
        }
    }

    hidden = yes

    option = {
        name = th_diplo_events.4.a
        clr_country_flag = th_has_already_a_planned_aggressor
        every_country = {
            limit = {
                has_country_flag = th_is_planned_aggressor_of_@ROOT
            }
            clr_country_flag = th_is_planned_aggressor_of_@ROOT
        }

        ai_chance = {
            factor = 100
        }
    }
}

###EIT DIPLO ACTIONS###
#Provoke War against Rival for EIT
country_event = {
    id = th_diplo_events.6
	title = th_diplo_events.6.t
	desc = th_diplo_events.6.desc
	picture = SPY_eventPicture

    is_triggered_only = yes

    immediate = {
        hidden_effect = {
        }
    }
    major = yes

    after = {
		every_country = {
			limit = {
				has_country_flag = th_eit_is_planned_aggressor_of_@ROOT
			}
            clr_country_flag = th_eit_is_planned_aggressor_of_@ROOT
		}
		while = {
			limit = {
				th_eit_has_at_least_one_aggressor = yes
			}
			th_eit_decrement_aggressor_counter = yes
		}
        clr_country_flag = th_has_already_a_planned_aggressor
    }

    option = {  #Excellent
        name = th_diplo_events.1.a
        hidden_effect = {
            every_country = {
                limit = {
                    has_country_flag = th_eit_is_planned_aggressor_of_@ROOT
                }
                country_event = {
                    id = th_diplo_events.8
                    days = 1
                }
            }
        }
    }
}

#Aggressor gets order to declare war
country_event = {
    id = th_diplo_events.8
	title = th_diplo_events.8.t
	desc = th_diplo_events.8.desc
    picture = DIPLOMACY_eventPicture
    
    major = yes

    is_triggered_only = yes

    immediate = {
        hidden_effect = {
            random_country = {
                limit = {
                    has_country_flag = th_eit_target_for_planned_war
                }
                save_event_target_as = planned_target_eit
            }
        }
    }

    after = {
        event_target:planned_target_eit = {
            clr_country_flag = th_eit_target_for_planned_war
        }
    }

    option = {  #To War!
        name = th_diplo_events.2.a
        trigger = {
            event_target:planned_target_eit = {
                exists = yes
            }
            is_free_or_tributary_trigger = yes
        }
        declare_war_with_cb = {
            casus_belli = cb_insult
            who = event_target:planned_target_eit            
        }

        ai_chance = {
            factor = 100
            modifier = {
                factor = 0
                was_player = yes
            }
            modifier = {
                factor = 0
                event_target:planned_target_eit = {
                    was_player = yes
                }
            }
            modifier = {
                factor = 0
                event_target:planned_target_eit = {
                    ai = no
                }
            }
        }
    }

    option = {  #We got tricked!
        name = th_diplo_events.2.b
        trigger = {
            OR = {
                event_target:planned_target_eit = {
                    exists = no
                }                
                is_free_or_tributary_trigger = no
            }
        }
        add_prestige = -25
        add_stability = -1

        ai_chance = {
            factor = 100
            modifier = {
                factor = 0
                was_player = yes
            }
        }
    }

    option = {  #There is something wrong...
        name = th_diplo_events.2.c

        ai_chance = {
            factor = 0
            modifier = {
                factor = 100
                was_player = yes
            }
            modifier = {
                factor = 100
                event_target:planned_target_eit = {
                    was_player = yes
                }
            }
            modifier = {
                factor = 100
                event_target:planned_target_eit = {
                    ai = no
                }
            }
        }
    }
}

#Clear flag if country is no longer able to be an aggressor for EIT
country_event = {
    id = th_diplo_events.9
	title = th_diplo_events.9.t
	desc = th_diplo_events.9.desc
	picture = SPY_eventPicture

    is_triggered_only = yes
    trigger = {
		th_eit_has_at_least_one_aggressor = yes
        calc_true_if = {
            all_country = {
                has_country_flag = th_eit_is_planned_aggressor_of_@ROOT
                is_free_or_tributary_trigger = no
            }
            amount = 1
        }
    }

    hidden = yes

    option = {
        name = th_diplo_events.9.a
        every_country = {
            limit = {
                has_country_flag = th_eit_is_planned_aggressor_of_@ROOT
                is_free_or_tributary_trigger = no
            }
            clr_country_flag = th_eit_is_planned_aggressor_of_@ROOT
			ROOT = {
				th_eit_decrement_aggressor_counter = yes
			}
        }

        ai_chance = {
            factor = 100
        }
    }
}

###HKR DIPLO ACTIONS###
#Nation broke peldging
country_event = {
    id = th_diplo_events.10
	title = th_diplo_events.10.t
	desc = th_diplo_events.10.desc
	picture = SHRINE_eventPicture
    
    is_triggered_only = yes

    option = {
        name = th_diplo_events.10.a
        every_known_country = {
            limit = {
                has_country_flag = th_pledged_religious_loyalty
                NOT = { has_country_modifier = th_pledged_to_remain_religious }
            }
            reverse_add_casus_belli = {
                type = cb_touhou_penance_war
                target = ROOT
                months = 240
            }
            hidden_effect = {
                clr_country_flag = th_pledged_religious_loyalty
                ROOT = { clr_country_flag = th_has_gotten_pledged_to_religion_from_@PREV }
            }
        }

        ai_chance = {
            factor = 100
        }
    }
}

#Removes punitive modifier if free again
country_event = {
    id = th_diplo_events.11
	title = th_diplo_events.11.t
	desc = th_diplo_events.11.desc
	picture = SHRINE_eventPicture

    hidden = yes
    is_triggered_only = yes
    trigger = {
        has_country_modifier = th_subjugated_in_penance
        is_subject = no
    }

    option = {
        name = th_diplo_events.11.a
        remove_country_modifier = th_subjugated_in_penance

        ai_chance = {
            factor = 100
        }
    }
}

###MRY DIPLO ACTIONS###
#Information about incited rebels
country_event = {
	id = th_diplo_events.12
	title = th_diplo_events.12.t
	desc = th_diplo_events.12.desc
	picture = SHRINE_eventPicture
	
	is_triggered_only = yes
	
	option = {
        name = th_diplo_events.12.a
        custom_tooltip = th_diplo_events.12.a.tt
        hidden_effect = {
			country_event = {
				id = th_diplo_events.13
				days = 1825
			}
        }
        add_opinion = {
            who = FROM
            modifier = th_has_incited_rebels
        }
		
		ai_chance = { 
			factor = 100
		}
	}
}

#Clear flag for Moriya incited rebels in target country
country_event = {
	id = th_diplo_events.13
	title = th_diplo_events.13.t
	desc = th_diplo_events.13.desc
	picture = LIBERUM_VETO_eventPicture
	
	is_triggered_only = yes

	hidden = yes
	
	option = {
		name = th_diplo_events.13.a
		clr_country_flag = th_has_already_incited_zealots
		
		ai_chance = { 
			factor = 100
		}
	}
}

#Information about Joon stealing from your treasury
country_event = {
	id = th_diplo_events.14
	title = th_diplo_events.14.t
	desc = th_diplo_events.14.desc
	picture = JOON_eventPicture
	
    is_triggered_only = yes
    
    immediate = {
        hidden_effect = {
            set_country_flag = th_has_been_already_looted_by_spies_of_@FROM
            export_to_variable = {
                which = th_money_to_steal
                value = monthly_income
                who = ROOT
            }            
            export_to_variable = {
                which = th_money_available
                value = treasury
                who = ROOT
            }
            multiply_variable = {
                which = th_money_to_steal
                value = 6
            }
            if = {
                limit = {
                    # Is th_money_to_steal greater than th_money_available
                    check_variable = {
                        which = th_money_to_steal
                        which = th_money_available
                    }
                }                
                # Set th_money_to_steal to th_money_available's value, as th_money_to_steal was greater than th_money_available
                set_variable = {
                    which = th_money_to_steal 
                    which = th_money_available 
                }
            }
            set_variable = {
                which = th_money_report
                which = th_money_to_steal 
            }
        }
    }
	
	option = {
        name = th_diplo_events.14.a
        custom_tooltip = th_diplo_events.14.a.tt
        th_transfer_treasury = {
            giver = ROOT
            taker = FROM
            variable = th_money_to_steal
        }
        add_casus_belli = {
            type = cb_insult
            target = FROM
            months = 300
        }
        add_opinion = {
            who = FROM
            modifier = th_has_stolen_treasury
        }
        hidden_effect = {
            FROM = {
                country_event = {
                    id = th_diplo_events.16
                }
            }
        }
		
		ai_chance = { 
			factor = 100
		}
    }
}

#Feedback of the heist
country_event = {
	id = th_diplo_events.16
	title = th_diplo_events.16.t
	desc = th_diplo_events.16.desc
	picture = JOON_eventPicture
	
    is_triggered_only = yes
	
	option = {
        name = th_diplo_events.16.a
        custom_tooltip = th_diplo_events.16.a.tt
		
		ai_chance = { 
			factor = 100
		}
	}
}


###FOM DIPLO ACTIONS###
# Inform target of being robbed
country_event = {
	id = th_diplo_events.15
	title = th_diplo_events.15.t
	desc = th_diplo_events.15.desc
	picture = JOON_eventPicture
	
    is_triggered_only = yes
	
	option = {
        name = th_diplo_events.15.a

        tooltip = {
            FROM = {
                add_country_modifier = {
                    name = th_stolen_books
                    duration = 1825
                }
            }
        }
        add_country_modifier = {
            name = th_has_less_books
            duration = 1825
        }
		
		ai_chance = { 
			factor = 100
		}
	}
}


###MORE HKR DIPLO ACTIONS###
#Recharger for Youkai hunts
country_event = {
	id = th_diplo_events.17
	title = th_diplo_events.17.t
	desc = th_diplo_events.17.desc
    picture = REIMU_eventPicture    
    hidden = yes
    is_triggered_only = yes
    trigger = {
        has_country_flag = th_enable_youkai_hunt
        NOT = {
            check_variable = {
                which = th_youkai_hunt_charges
                value = 5
            }
        }
    }
	
	option = {
        name = th_diplo_events.17.a
        change_variable = {
            which = th_youkai_hunt_charges
            value = 1
        }
		
		ai_chance = { 
			factor = 100
		}
    }
}

#Youkai Hunt - Danmaku fight Setup
country_event = {
	id = th_diplo_events.18
	title = th_diplo_events.18.t
	desc = th_diplo_events.18.desc
	picture = REIMUMARISABATTLE_eventPicture
	
    is_triggered_only = yes
    hidden = yes
	
	immediate = {
        export_to_variable = {
            which = th_youkai_hunt_own_development
            value = total_development
            who = ROOT
        }
        if = {
            limit = {
                total_development = 300
            }
            multiply_variable = {
                which = th_youkai_hunt_own_development
                value = 1.5
            }
            change_variable = {
                which = th_youkai_hunt_own_development
                value = 1550
            }
        }
        else = {
            multiply_variable = {
                which = th_youkai_hunt_own_development
                value = 4
            }
            change_variable = {
                which = th_youkai_hunt_own_development
                value = 800
            }
        }
        FROM = {
            set_variable = {
                which = th_youkai_hunt_youkai_development
                value = 0
            }
        }
	}
	
	option = {
        name = th_diplo_events.18.a
        th_export_root_variable_into_foreign = {
            who = FROM
            root_variable = th_youkai_hunt_own_development
            foreign_variable = th_youkai_hunt_youkai_development
        }

		ai_chance = { 
			factor = 100
		}
    }
    
    after = {
        FROM = {
            country_event = {
                id = th_diplo_events.19
                days = 7
            }
        }
    }
}

#Youkai Hunt - Danmaku fight
country_event = {
	id = th_diplo_events.19
	title = th_diplo_events.19.t
	desc = th_diplo_events.19.desc
	picture = REIMUMARISABATTLE_eventPicture
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			th_getruler_fighting_skill = {
				skill_boni = 0
                type = normal
            }            
			set_variable = {
				which = th_youkai_hunt_youkai_combat_skills
				value = 0
            }
            change_variable = {
                which = th_youkai_hunt_youkai_combat_skills
                which = th_youkai_hunt_youkai_development
            }
			th_defineopponent_fighting_skill = {
				variable = th_youkai_hunt_youkai_combat_skills
				type = normal
			}
		}
	}
	
	option = {	#TAKE THIS
		name = th_diplo_events.19.a
		custom_tooltip = th_diplo_events.19.a.tt
        highlight = yes
        #th_empty_event.1 because the evulation event has important effects and I am too lazy to replace them
		th_danmaku_normal_fight_ruler_and_opponent = {
            win_event = th_empty_event.1
            draw_event = th_empty_event.1
            defeat_event = th_empty_event.1
            days = 1
        }
		hidden_effect = {
            if = {
                limit = {
                    check_variable = {
                        which = th_youkai_hunt_refusal_counter
                        value = 1
                    }
                }
                subtract_variable = {
                    which = th_youkai_hunt_refusal_counter
                    value = 1
                }
            }
            FROM = {
                country_event = {
                    id = th_diplo_events.20
                    days = 10
                }
            }
		}			

		ai_chance = { 
			factor = 100
		}
    }
    
    option = {  #Stupid idea
        name = th_diplo_events.19.b
        custom_tooltip = th_diplo_events.19.b.tt
        trigger = {
            NOT = {
                check_variable = {
                    which = th_youkai_hunt_refusal_counter
                    value = 3
                }
            }
        }
        hidden_effect = {
            change_variable = {
                which = th_youkai_hunt_refusal_counter
                value = 1
            }
        }
        FROM = {
            add_opinion = {
                who = ROOT
                modifier = th_betrayed_their_contract
            }
        }
    }
}

#Youkai Hunt fight evulator
country_event = {
	id = th_diplo_events.20
	title = th_diplo_events.20.t
	desc = th_diplo_events.20.desc
	picture = REIMUMARISABATTLE_eventPicture
	
	is_triggered_only = yes
    hidden = yes
	
	immediate = {
        export_to_variable = {
            which = th_youkai_hunt_own_development
            value = total_development
        }
        FROM = {
            set_variable = {
                which = th_youkai_cash
                value = 0
            }
        }
        th_export_root_variable_into_foreign = {
            who = FROM
            root_variable = th_youkai_hunt_own_development
            foreign_variable = th_youkai_cash
        }
	}

	option = {
		name = th_diplo_events.20.a
		if = {
			limit = {
                FROM = {
                    has_country_flag = th_normal_last_fight_won
                }
            }
            set_country_flag = th_has_already_youkai_hunted
            add_opinion = {
                who = FROM
                modifier = th_fulfilled_their_contract
            }
            FROM = {
                country_event = {
                    id = th_diplo_events.21
                }
            }
		}
		else = {
            FROM = {
                country_event = {
                    id = th_diplo_events.22
                }
            }
            add_opinion = {
                who = FROM
                modifier = th_failed_their_contract
            }
		}

		ai_chance = { 
			factor = 100
		}
    }
}

#Youkai Hunt - Victory
country_event = {
	id = th_diplo_events.21
	title = th_diplo_events.21.t
	desc = th_diplo_events.21.desc
	picture = REIMUMARISABATTLE_eventPicture
	
    is_triggered_only = yes
    
    immediate = {
        hidden_effect = {
            if = {
                limit = {
                    has_country_flag = th_increased_youkai_hunt_income
                }
                multiply_variable = {
                    which = th_youkai_cash
                    value = 2
                }
            }
            else = {
                multiply_variable = {
                    which = th_youkai_cash
                    value = 1
                }
            }
            change_variable = {
                which = th_youkai_cash
                value = 50
            }
            set_variable = {
                which = th_youkai_cash_show
                which = th_youkai_cash
            }
        }
    }
	
	option = {
        name = th_diplo_events.21.a
        custom_tooltip = th_diplo_events.21.a.tt
        while = {
            limit = {
                check_variable = {
                    which = th_youkai_cash
                    value = 1
                }
            }
            add_treasury = 1
            subtract_variable = {
                which = th_youkai_cash
                value = 1
            }
        }

		ai_chance = { 
			factor = 100
		}
	}
}

#Youkai Hunt - Defeat
country_event = {
	id = th_diplo_events.22
	title = th_diplo_events.22.t
	desc = th_diplo_events.22.desc
	picture = REIMUMARISABATTLE_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = th_diplo_events.22.a

		ai_chance = { 
			factor = 100
		}
	}
}


###DANMAKU DUEL ACTION###

#Danmaku Duel - Challenged one can accept
country_event = {
    id = th_diplo_events.23
	title = th_diplo_events.23.t
	desc = th_diplo_events.23.desc
	picture = REIMUMARISABATTLE_eventPicture
	
    is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
            set_country_flag = th_was_already_danmaku_challenged_by_@FROM
            th_getruler_fighting_skill = {
                skill_boni = 0
                type = normal
            }
            FROM = {
                set_variable = {
                    which = th_danmaku_duel_enemy_power
                    value = 0
                }
            }
		}
	}
    
    #BRING IT ON
    option = {
        name = th_diplo_events.23.a
        custom_tooltip = th_diplo_events.23.a.tt
        hidden_effect = {
            th_danmaku_set_compare_variable = {
                type = normal
            }
            th_export_root_variable_into_foreign = {
                who = FROM
                root_variable = th_current_fighting_skills_counter
                foreign_variable = th_danmaku_duel_enemy_power
            }
            set_variable = {
                which = th_declined_danmaku_duel_counter
                value = 0
            }
        }
        FROM = {
            country_event = {
                id = th_diplo_events.24
                days = 3
            }
            hidden_effect = {
                add_country_modifier = {
                    name = th_was_in_danmaku_duel
                    duration = 1095
                    hidden = yes
                }
            }
        }

        ai_chance = {
            factor = 0.20
            modifier = {
                factor = 4
                mil = FROM
            }
            modifier = {
                factor = 100
                FROM = { has_government_attribute = th_decreased_danmaku_duel_refusal }
            }
        }
    }

    #I don't have time for games   
    option = {
        name = th_diplo_events.23.b
        trigger = {
            NOT = {
                check_variable = {
                    which = th_declined_danmaku_duel_counter
                    value = 3
                }
            }
        }
        add_power_projection = {
            type = th_has_declined_danmaku_duel
            amount = -5
        }
        FROM = {
            country_event = {
                id = th_diplo_events.25
                days = 3
            }
        }
        hidden_effect = {
            #set_country_flag = th_danmaku_duel_lost_against_@FROM
            change_variable = {
                which = th_declined_danmaku_duel_counter
                value = 1
            }
        }

        ai_chance = {
            factor = 0.75
            modifier = {
                factor = 0.33
                mil = FROM
            }
            modifier = {
                factor = 0
                FROM = { has_government_attribute = th_decreased_danmaku_duel_refusal }
            }
        }
    }
}

#Danmaku Duel - Danmaku fight
country_event = {
	id = th_diplo_events.24
	title = th_diplo_events.24.t
	desc = th_diplo_events.24.desc
	picture = REIMUMARISABATTLE_eventPicture
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
            th_getruler_fighting_skill = {
                skill_boni = 0
                type = normal
            }
			th_defineopponent_fighting_skill = {
				variable = th_danmaku_duel_enemy_power
				type = normal
			}
            if = { 
                limit = { 
                    has_country_flag = fuj_has_leveling_mokou
                    FROM = {
                        OR = {
                            th_is_or_was_tag = { tag = HKR }
                            th_is_or_was_tag = { tag = FOM }
                            th_is_or_was_tag = { tag = SCR }
                            th_is_or_was_tag = { tag = EIT }
                            th_is_or_was_tag = { tag = NET }
                            is_enemy = ROOT
                            is_rival = ROOT
                            is_great_power = yes
                            total_development = ROOT
                        }
                    }
                }
                set_country_flag = fuj_duels_important_person
            }
		}
	}
	
	option = {	#TAKE THIS
		name = th_diplo_events.24.a
		custom_tooltip = th_diplo_events.24.a.tt
        highlight = yes
		th_danmaku_normal_fight_ruler_and_opponent = {
            win_event = th_diplo_events.26
            draw_event = th_diplo_events.260
            defeat_event = th_diplo_events.27
            days = 3
        }
		hidden_effect = {
            FROM = {
                set_country_flag = th_danmaku_duel_target_for_@ROOT
            }
		}

		ai_chance = { 
			factor = 1
		}
    }
    
    option = {  #Stupid idea
        name = th_diplo_events.24.b
        add_power_projection = {
            type = th_has_declined_danmaku_duel
            amount = -5
        }
        FROM = {
            country_event = {
                id = th_diplo_events.30
            }
        }

		ai_chance = { 
			factor = 0
		}
    }
}

#Danmaku Duel - Target declines duel
country_event = {
	id = th_diplo_events.25
	title = th_diplo_events.25.t
	desc = th_diplo_events.25.desc
	picture = REIMUMARISABATTLE_eventPicture
	
	is_triggered_only = yes

    immediate = {
        hidden_effect = {
            if = {
                limit = { has_country_flag = fuj_duels_important_person }
                clr_country_flag = fuj_duels_important_person
            }
        }
    }
	
	option = {
        name = th_diplo_events.25.a
        add_power_projection = {
            type = th_enemy_declined_danmaku_duel
            amount = 5
        }

		ai_chance = { 
			factor = 100
		}
	}
}

#Danmaku Duel - Victory for the Challenger
country_event = {
	id = th_diplo_events.26
	title = th_diplo_events.26.t
	desc = th_diplo_events.26.desc
	picture = REIMUMARISABATTLE_eventPicture
	
	is_triggered_only = yes

    immediate = {
        hidden_effect = {
            if = {
                limit = { has_country_flag = fuj_duels_important_person }
                clr_country_flag = fuj_duels_important_person
                change_variable = {
                    which = fuj_danmaku_win
                    value = 1
                }
            }
        }
    }
	
	option = {
        name = th_diplo_events.26.a
        add_power_projection = {
            type = th_won_danmaku_duel_power_projection
            amount = 30
        }
        random_country = {
            limit = {
                has_country_flag = th_danmaku_duel_target_for_@ROOT
            }
            country_event = {
                id = th_diplo_events.28
            }
        }
        if = {
            limit = { has_country_flag = fuj_has_leveling_mokou }
            change_variable = {
                which = fuj_mokou_exp
                value = 25
            }
        }

		ai_chance = { 
			factor = 100
		}
	}
}

#Danmaku Duel - Draw for the Challenger
country_event = {
	id = th_diplo_events.260
	title = th_diplo_events.260.t
	desc = th_diplo_events.260.desc
	picture = REIMUMARISABATTLE_eventPicture
	
	is_triggered_only = yes
	
	option = {
        name = th_diplo_events.260.a
        custom_tooltip = th_diplo_events.260.a.tt
        random_country = {
            limit = {
                has_country_flag = th_danmaku_duel_target_for_@ROOT
            }
            country_event = {
                id = th_diplo_events.280
            }
        }

		ai_chance = { 
			factor = 100
		}
	}
}

#Danmaku Duel - Defeat for the Challenger
country_event = {
	id = th_diplo_events.27
	title = th_diplo_events.27.t
	desc = th_diplo_events.27.desc
	picture = REIMUMARISABATTLE_eventPicture
	
	is_triggered_only = yes
	
	option = {
        name = th_diplo_events.27.a
        add_power_projection = {
            type = th_lost_danmaku_duel_power_projection
            amount = -30
        }
        random_country = {
            limit = {
                has_country_flag = th_danmaku_duel_target_for_@ROOT
            }
            country_event = {
                id = th_diplo_events.29
            }
        }

		ai_chance = { 
			factor = 100
		}
	}
}

#Danmaku Duel - Defeat for the Challenged one
country_event = {
	id = th_diplo_events.28
	title = th_diplo_events.28.t
	desc = th_diplo_events.28.desc
	picture = REIMUMARISABATTLE_eventPicture
	
    is_triggered_only = yes
    
    immediate = {
        hidden_effect = {
            clr_country_flag = th_danmaku_duel_target_for_@FROM
            set_country_flag = th_danmaku_duel_lost_against_@FROM
        }
    }
	
	option = {
        name = th_diplo_events.28.a
        add_power_projection = {
            type = th_lost_danmaku_duel_power_projection
            amount = -30
        }

		ai_chance = { 
			factor = 100
		}
	}
}

#Danmaku Duel - Draw for the Challenged one
country_event = {
	id = th_diplo_events.280
	title = th_diplo_events.280.t
	desc = th_diplo_events.280.desc
	picture = REIMUMARISABATTLE_eventPicture
	
    is_triggered_only = yes
    
    immediate = {
        hidden_effect = {
            clr_country_flag = th_danmaku_duel_target_for_@FROM
        }
    }
	
	option = {
        name = th_diplo_events.280.a
        custom_tooltip = th_diplo_events.280.a.tt

		ai_chance = { 
			factor = 100
		}
	}
}

#Danmaku Duel - Win for the Challenged one
country_event = {
	id = th_diplo_events.29
	title = th_diplo_events.29.t
	desc = th_diplo_events.29.desc
	picture = REIMUMARISABATTLE_eventPicture
	
    is_triggered_only = yes
    
    immediate = {
        hidden_effect = {
            clr_country_flag = th_danmaku_duel_target_for_@FROM
        }
    }
	
	option = {
        name = th_diplo_events.29.a
        add_power_projection = {
            type = th_won_danmaku_duel_power_projection
            amount = 30
        }

		ai_chance = { 
			factor = 100
		}
	}
}

#Danmaku Duel - Challenger abandones fight
country_event = {
	id = th_diplo_events.30
	title = th_diplo_events.30.t
	desc = th_diplo_events.30.desc
	picture = REIMUMARISABATTLE_eventPicture
	
	is_triggered_only = yes
	
	option = {
        name = th_diplo_events.30.a
        add_power_projection = {
            type = th_enemy_declined_danmaku_duel
            amount = 5
        }

		ai_chance = { 
			factor = 100
		}
	}
}

###FAIRY PRANKS###

#Pranks - Generic for all non-special fairies
country_event = {
    id = th_diplo_events.31
    title = th_diplo_events.31.t
    desc = th_diplo_events.31.desc
    picture = ALLFAIRIES_eventPicture
    
    is_triggered_only = yes

    immediate = {
        hidden_effect = {
			set_country_flag = th_was_pranked_by_@FROM
        }
    }

    option = {
        name = th_diplo_events.31.a
        add_country_modifier = {
            name = th_they_pranked_us
            duration = 3650
        }
        add_casus_belli = {
            type = cb_insult
            target = FROM
			months = 240
        }
        add_opinion = {
            who = FROM
            modifier = th_they_pranked_us_opinion
        }
        
        ai_chance = {
            factor = 100
        }
    }
}

#Pranks - Cirno
country_event = {
    id = th_diplo_events.32
    title = th_diplo_events.32.t
    desc = th_diplo_events.32.desc
    picture = CIRNO_eventPicture
    
    is_triggered_only = yes

    immediate = {
        hidden_effect = {
			set_country_flag = th_was_pranked_by_@FROM
        }
    }

    option = {
        name = th_diplo_events.32.a
        add_yearly_manpower = -0.15
        if = {
            limit = {
                FROM = {
                    has_country_flag = cin_letty_empowered_prank
                }
            }
            add_country_modifier = {
                name = th_cin_icy_winds_lvl2
                duration = 3650
            }
        }
        else = {
            add_country_modifier = {
                name = th_cin_icy_winds
                duration = 3650
            }            
        }
        add_casus_belli = {
            type = cb_insult
            target = FROM
			months = 240
        }
        add_opinion = {
            who = FROM
            modifier = th_they_pranked_us_opinion
        }
        
        ai_chance = {
            factor = 100
        }
    }
}

#Pranks - Clownpiece
country_event = {
    id = th_diplo_events.33
    title = th_diplo_events.33.t
    desc = th_diplo_events.33.desc
    picture = CLOWNPIECE_eventPicture
    
    is_triggered_only = yes

    immediate = {
        hidden_effect = {
			set_country_flag = th_was_pranked_by_@FROM
        }
    }

    option = {
        name = th_diplo_events.33.a
        capital_scope = {
            add_devastation = 15
        }
        add_country_modifier = {
            name = th_clp_insanity
            duration = 3650
        }
        add_casus_belli = {
            type = cb_insult
            target = FROM
			months = 240
        }
        add_opinion = {
            who = FROM
            modifier = th_they_pranked_us_opinion
        }
        
        ai_chance = {
            factor = 100
        }
    }
}

#Pranks - Sunny
country_event = {
    id = th_diplo_events.34
    title = th_diplo_events.34.t
    desc = th_diplo_events.34.desc
    picture = THREEFAIRIES_eventPicture
    
    is_triggered_only = yes

    immediate = {
        hidden_effect = {
			set_country_flag = th_was_pranked_by_@FROM
        }
    }

    option = {
        name = th_diplo_events.34.a
        if = {
            limit = {
                has_country_flag = tfr_upgraded_prank
            }
            add_war_exhaustion = 5
            add_country_modifier = {
                name = th_tfr_sunny_fort_illusions_upgraded
                duration = 3650
            }
        }
        else = {
            add_war_exhaustion = 2
            add_country_modifier = {
                name = th_tfr_sunny_fort_illusions
                duration = 3650
            }
        }
        add_casus_belli = {
            type = cb_insult
            target = FROM
			months = 240
        }
        add_opinion = {
            who = FROM
            modifier = th_they_pranked_us_opinion
        }
        
        ai_chance = {
            factor = 100
        }
    }
}

#Pranks - Luna
country_event = {
    id = th_diplo_events.35
    title = th_diplo_events.35.t
    desc = th_diplo_events.35.desc
    picture = THREEFAIRIES_eventPicture
    
    is_triggered_only = yes

    immediate = {
        hidden_effect = {
			set_country_flag = th_was_pranked_by_@FROM
        }
    }

    option = {
        name = th_diplo_events.35.a
        if = {
            limit = {
                has_country_flag = tfr_upgraded_prank
            }
            add_prestige = -40
            add_country_modifier = {
                name = th_tfr_luna_muted_diplomats_upgraded
                duration = 3650
            }
        }
        else = {
            add_prestige = -20
            add_country_modifier = {
                name = th_tfr_luna_muted_diplomats
                duration = 3650
            }
        }

        add_casus_belli = {
            type = cb_insult
            target = FROM
			months = 240
        }
        add_opinion = {
            who = FROM
            modifier = th_they_pranked_us_opinion
        }
        
        ai_chance = {
            factor = 100
        }
    }
}

#Pranks - Star
country_event = {
    id = th_diplo_events.36
    title = th_diplo_events.36.t
    desc = th_diplo_events.36.desc
    picture = THREEFAIRIES_eventPicture
    
    is_triggered_only = yes

    immediate = {
        hidden_effect = {
			set_country_flag = th_was_pranked_by_@FROM
        }
    }

    option = {
        name = th_diplo_events.36.a
        if = {
            limit = {
                has_country_flag = tfr_upgraded_prank
            }
            remove_fow = 60
            add_country_modifier = {
                name = th_tfr_star_detect_movement_upgraded
                duration = 1825
            }
        }
        else = {
            remove_fow = 60
            add_country_modifier = {
                name = th_tfr_star_detect_movement
                duration = 1825
            }            
        }
        custom_tooltip = th_diplo_events.36.a.tt
        hidden_effect = {
            FROM = {
                country_event = {
                    id = th_diplo_events.360
                }
            }
        }
        add_casus_belli = {
            type = cb_insult
            target = FROM
			months = 240
        }
        add_opinion = {
            who = FROM
            modifier = th_they_pranked_us_opinion
        }
        
        ai_chance = {
            factor = 100
        }
    }
}

#Pranks - Star (FoW deleter)
country_event = {
    id = th_diplo_events.360
    title = th_diplo_events.360.t
    desc = th_diplo_events.360.desc
    picture = THREEFAIRIES_eventPicture
    
    is_triggered_only = yes
    hidden = yes

    option = {
        name = th_diplo_events.360.a
        FROM = {
            remove_fow = 24
        }
        
        ai_chance = {
            factor = 100
        }
    }
}

#Pranks - Lily
country_event = {
    id = th_diplo_events.37
    title = th_diplo_events.37.t
    desc = th_diplo_events.37.desc
    picture = CLOWNPIECE_eventPicture
    
    is_triggered_only = yes

    immediate = {
        hidden_effect = {
			set_country_flag = th_was_pranked_by_@FROM
        }
    }

    option = {
        name = th_diplo_events.37.a
        add_opinion = {
            who = FROM
            modifier = th_got_informed_about_spring
        }
        
        ai_chance = {
            factor = 100
        }
    }
}

#Pranks - Larva
country_event = {
    id = th_diplo_events.38
    title = th_diplo_events.38.t
    desc = th_diplo_events.38.desc
    picture = CLOWNPIECE_eventPicture
    
    is_triggered_only = yes

    immediate = {
        hidden_effect = {
			set_country_flag = th_was_pranked_by_@FROM
        }
    }

    option = {
        name = th_diplo_events.38.a
        add_opinion = {
            who = FROM
            modifier = th_good_weather_cause
        }
        add_country_modifier = {
            name = th_lrv_amplified_weather
            duration = 3650
        }
        
        ai_chance = {
            factor = 100
        }
    }
}

###SATORI'S MIND ABILITY###
#Event to trigger if there is no noteworthy diplomatic action to copy
country_event = {
    id = th_diplo_events.39
    title = th_diplo_events.39.t
    desc = th_diplo_events.39.desc
    picture = SATORI_eventPicture
    
    is_triggered_only = yes

    option = {
        name = th_diplo_events.39.a
        trigger_switch = {
            on_trigger = has_country_flag
            th_copied_ability_of_FUJ = { add_country_modifier = { name = th_copy_ability_from_NET duration = 1825 } }
            th_copied_ability_of_NET = { add_country_modifier = { name = th_copy_ability_from_FUJ duration = 1825 } }
            th_copied_ability_of_SFF = { add_country_modifier = { name = th_copy_ability_from_SFF duration = 1825 } }
            th_copied_ability_of_HIG = { add_country_modifier = { name = th_copy_ability_from_HIG duration = 1825 } }
            th_copied_ability_of_MKI = { add_country_modifier = { name = th_copy_ability_from_MKI duration = 1825 } }
            th_copied_ability_of_GNU = { add_country_modifier = { name = th_copy_ability_from_GNU duration = 1825 } }
            th_copied_ability_of_FLR = { add_country_modifier = { name = th_copy_ability_from_FLR duration = 1825 } }
        }
        
        ai_chance = {
            factor = 100
        }
    }

    after = {
        hidden_effect = {
            th_clear_copy_flag = yes
        }
    }
}

##Clear flags when the timer runs out
#country_event = {
#    id = th_diplo_events.40
#    title = th_diplo_events.40.t
#    desc = th_diplo_events.40.desc
#    picture = SATORI_eventPicture
#    
#    trigger = {
#        NOT = { has_country_modifier = th_copied_ability }
#        has_country_flag = th_copied_ability_flag
#    }
#
#    mean_time_to_happen = {
#        days = 0
#    }
#
#    hidden = yes
#
#    option = {
#        name = th_diplo_events.40.a
#        th_clear_copy_flag = yes
#        
#        ai_chance = {
#            factor = 100
#        }
#    }
#}

#Target country gets manipulated into becoming a vassal of Satori
country_event = {
    id = th_diplo_events.41
    title = th_diplo_events.41.t
    desc = th_diplo_events.41.desc
    picture = SATORI_eventPicture
    
    is_triggered_only = yes

    option = {  #Satori Komeiji commands you: Obey!
        name = th_diplo_events.41.a
        FROM = {
            create_subject = {
                subject_type = th_satori_vassal
                subject = ROOT
            }
            add_truce_with = ROOT
            country_event = {
                id = th_diplo_events.42
            }
        }
        hidden_effect = {
            set_country_flag = th_vassalized_through_mind_ability_by_@FROM
        }

        ai_chance = {
            factor = 1
            #No longer needed, might be useful for similar diplo actions in the future though
            #factor = 0.6
            #modifier = {
            #    factor = 2
            #    check_variable = {
            #        which = th_spy_progress
            #        value = 1
            #    }
            #}
            #modifier = {
            #    factor = 2
            #    check_variable = {
            #        which = th_spy_progress
            #        value = 2
            #    }
            #}
            #modifier = {
            #    factor = 2
            #    check_variable = {
            #        which = th_spy_progress
            #        value = 3
            #    }
            #}
            #modifier = {
            #    factor = 2
            #    check_variable = {
            #        which = th_spy_progress
            #        value = 4
            #    }
            #}
            #modifier = {
            #    factor = 2
            #    check_variable = {
            #        which = th_spy_progress
            #        value = 5
            #    }
            #}
            #modifier = {
            #    factor = 2
            #    check_variable = {
            #        which = th_spy_progress
            #        value = 6
            #    }
            #}
            #modifier = {
            #    factor = 2
            #    check_variable = {
            #        which = th_spy_progress
            #        value = 7
            #    }
            #}
            #modifier = {
            #    factor = 2
            #    check_variable = {
            #        which = th_spy_progress
            #        value = 8
            #    }
            #}
        }
    }

    option = {  #We will never follow a tyrann!
        name = th_diplo_events.41.b
        FROM = {
            country_event = {
                id = th_diplo_events.43
            }
        }

        ai_chance = {
            factor = 0
            #No longer needed, might be useful for similar diplo actions in the future though
            #factor = 0.4
            #modifier = {
            #    factor = 0.5
            #    check_variable = {
            #        which = th_spy_progress
            #        value = 1
            #    }
            #}
            #modifier = {
            #    factor = 0.5
            #    check_variable = {
            #        which = th_spy_progress
            #        value = 2
            #    }
            #}
            #modifier = {
            #    factor = 0.5
            #    check_variable = {
            #        which = th_spy_progress
            #        value = 3
            #    }
            #}
            #modifier = {
            #    factor = 0.5
            #    check_variable = {
            #        which = th_spy_progress
            #        value = 4
            #    }
            #}
            #modifier = {
            #    factor = 0.5
            #    check_variable = {
            #        which = th_spy_progress
            #        value = 5
            #    }
            #}
            #modifier = {
            #    factor = 0.5
            #    check_variable = {
            #        which = th_spy_progress
            #        value = 6
            #    }
            #}
            #modifier = {
            #    factor = 0.5
            #    check_variable = {
            #        which = th_spy_progress
            #        value = 7
            #    }
            #}
            #modifier = {
            #    factor = 0.5
            #    check_variable = {
            #        which = th_spy_progress
            #        value = 8
            #    }
            #}
        }
    }
}

#Target country is our vassal!
country_event = {
    id = th_diplo_events.42
    title = th_diplo_events.42.t
    desc = th_diplo_events.42.desc
    picture = SATORI_eventPicture
    
    is_triggered_only = yes

    option = {  #Lovely
        name = th_diplo_events.42.a
        tooltip = {
            create_subject = {
                subject_type = th_satori_vassal
                subject = FROM
            }
        }

        ai_chance = {
            factor = 1
        }
    }
}

#Target country refuses!
country_event = {
    id = th_diplo_events.43
    title = th_diplo_events.43.t
    desc = th_diplo_events.43.desc
    picture = SATORI_eventPicture
    
    is_triggered_only = yes

    option = {  #Curses
        name = th_diplo_events.43.a

        ai_chance = {
            factor = 1
        }
    }
}

#Target country awakens out of the hypnosis done by Satori!
country_event = {
    id = th_diplo_events.44
    title = th_diplo_events.44.t
    desc = th_diplo_events.44.desc
    picture = SATORI_eventPicture
    is_triggered_only = yes
    hidden = yes

    option = {  #Curses
        name = th_diplo_events.44.a
        if = {
            limit = {
                is_subject_of_type = th_satori_vassal
            }
            add_country_modifier = {
                name = th_awoken_from_the_hybnosis
                duration = 3650
            }
        }

        ai_chance = {
            factor = 1
        }
    }
}

#Read the targets mind and cause trauma
country_event = {
    id = th_diplo_events.45
    title = th_diplo_events.45.t
    desc = th_diplo_events.45.desc
    picture = SATORI_eventPicture
    
    is_triggered_only = yes

    immediate = {
        hidden_effect = {
			set_country_flag = th_awoken_traumas_by_@FROM
        }
    }

    option = {
        name = th_diplo_events.45.a
        add_country_modifier = {
            name = th_awoken_traumas
            duration = 1825
        }
        custom_tooltip = th_diplo_events.36.a.tt
        hidden_effect = {
            FROM = {
                country_event = {
                    id = th_diplo_events.450
                }
            }
        }
        remove_fow = 60
        
        ai_chance = {
            factor = 100
        }
    }
}

#Read the targets mind and cause trauma (FoW deleter)
country_event = {
    id = th_diplo_events.450
    title = th_diplo_events.450.t
    desc = th_diplo_events.450.desc
    picture = SATORI_eventPicture
    
    is_triggered_only = yes
    hidden = yes

    option = {
        name = th_diplo_events.450.a
        FROM = {
            remove_fow = 60
        }
        
        ai_chance = {
            factor = 100
        }
    }
}

#Remove money from overlord
country_event = {
    id = th_diplo_events.46
    title = th_diplo_events.46.t
    desc = th_diplo_events.46.desc
    picture = SATORI_eventPicture
    
    is_triggered_only = yes
    trigger = {
        has_country_modifier = th_hellish_officers
        OR = {
            NOT = { has_country_flag = th_wasted_overlords_money }
            had_country_flag = {
                flag = th_wasted_overlords_money
                days = 364
            }
        }
        had_country_flag = {
            flag = th_officers_had_first_free_month
            days = 30
        }
        is_subject = yes
        OR = {
            is_subject_of_type = th_satori_vassal
            is_subject_of_type = th_pet_state
        }
    }

    hidden = yes

    immediate = {
        clr_country_flag = th_wasted_overlords_money
        export_to_variable = {
            which = th_money_to_delete_from_overlord
            value = years_of_income
        }
        export_to_variable = {
            which = th_own_army_size
            value = trigger_value:army_size_percentage
        }
        multiply_variable = {
            which = th_money_to_delete_from_overlord
            which = th_own_army_size
        }
        set_variable = {
            which = th_deleted_money_tooltip
            which = th_money_to_delete_from_overlord
        }
    }

    option = {
        name = th_diplo_events.46.a
        set_country_flag = th_wasted_overlords_money
        while = {
            limit = {
                check_variable = {
                    which = th_money_to_delete_from_overlord
                    value = 1
                }
            }
            overlord = {
                add_treasury = -1
            }
            subtract_variable = {
                which = th_money_to_delete_from_overlord
                value = 1
            }
        }
        multiply_variable = {
            which = th_money_to_delete_from_overlord
            value = 100
        }
        while = {
            limit = {
                check_variable = {
                    which = th_money_to_delete_from_overlord
                    value = 1
                }
            }
            overlord = {
                add_treasury = -0.01
            }
            subtract_variable = {
                which = th_money_to_delete_from_overlord
                value = 1
            }
        }

        overlord = {
            country_event = {
                id = th_diplo_events.460
            }
        }
        
        ai_chance = {
            factor = 100
        }
    }
}

#Let overlord know his officers are taking his money
country_event = {
    id = th_diplo_events.460
    title = th_diplo_events.460.t
    desc = th_diplo_events.460.desc
    picture = SATORI_eventPicture
    
    is_triggered_only = yes

    option = {
        name = th_diplo_events.460.a
        custom_tooltip = th_diplo_events.460.a.tt
        
        ai_chance = {
            factor = 100
        }
    }
}

#Let overlord know his officers are taking his money
country_event = {
    id = th_diplo_events.461
    title = th_diplo_events.461.t
    desc = none
    picture = none
    
    hidden = yes
    is_triggered_only = yes

    trigger = {
        has_country_modifier = th_hellish_officers
        NOT = { is_subject_of_type = th_satori_vassal }
        NOT = { is_subject_of_type = th_pet_state }
    }

    option = {
        remove_country_modifier = th_hellish_officers
        
        ai_chance = {
            factor = 100
        }
    }
}

#CRUSADE!
country_event = {
    id = th_diplo_events.47
    title = th_diplo_events.47.t
    desc = th_diplo_events.47.desc
    picture = SANAEBOSS_eventPicture
    
    is_triggered_only = yes

    immediate = {
        hidden_effect = {
            random_country = {
                limit = {
                    has_country_modifier = th_mry_crusade_target
                }
                save_event_target_as = th_mry_crusade_event_target
            }
        }
    }

    option = {
        name = th_diplo_events.47.a
        custom_tooltip = th_diplo_events.47.a.tt
        
        ai_chance = {
            factor = 100
        }
    }
}

#CRUSADE!
country_event = {
    id = th_diplo_events.470
    title = th_diplo_events.470.t
    desc = none
    picture = SANAEBOSS_eventPicture
    hidden = yes
    
    is_triggered_only = yes
    trigger = {
        NOT = { has_country_modifier = th_mry_crusade_target }
        any_known_country = {
            has_country_modifier = th_mry_crusade_target
            war_with = ROOT
            NOT = { religion = ROOT }
        }
        OR = {
            any_known_country = {
                mry_uses_faith_power = yes
                NOT = { tag = ROOT }
                religion = ROOT
            }
            mry_uses_faith_power = yes
        }
        NOT = { has_country_modifier = th_faith_power_war_against_crusade_target }
    }

    option = {
        add_country_modifier = {
            name = th_faith_power_war_against_crusade_target
            duration = -1
        }
        ai_chance = {
            factor = 100
        }
    }
}

#No longer crusade
country_event = {
    id = th_diplo_events.471
    title = th_diplo_events.471.t
    desc = none
    picture = SANAEBOSS_eventPicture
    hidden = yes
    
    is_triggered_only = yes
    trigger = {
        has_country_modifier = th_faith_power_war_against_crusade_target
        OR = {
            is_at_war = no
            NOT = {
                any_known_country = {
                    war_with = ROOT
                    NOT = { has_country_modifier = th_mry_crusade_target }
                }
            }
            AND = {
                NOT = {
                    any_known_country = {
                        mry_uses_faith_power = yes
                        NOT = { tag = ROOT }
                        religion = ROOT
                    }
                }
                NOT = { mry_uses_faith_power = yes }
            }
        }
    }

    option = {
        remove_country_modifier = th_faith_power_war_against_crusade_target
        ai_chance = {
            factor = 100
        }
    }
}

#Trade Post Charter - FROM
country_event = {
    id = th_diplo_events.48
    title = none
    desc = none
    picture = none
    is_triggered_only = yes
    hidden = yes

    option = {
        FROM = {
            country_event = {
                id = th_diplo_events.480
            }
        }
        
        ai_chance = {
            factor = 100
        }
    }
}

#Trade Post Charter - ROOT
country_event = {
    id = th_diplo_events.480
    title = th_diplo_events.480.t
    desc = th_diplo_events.480.desc
    picture = RINNOSUKE_eventPicture
    is_triggered_only = yes

    immediate = {
        hidden_effect = {
            set_country_flag = th_has_trade_post_event_open
            FROM = {
                set_country_flag = th_has_trade_deal_event
                random_owned_province = {
                    limit = {
						is_capital = no
						has_port = yes
						NOT = {
							region_for_scope_province = {
								country_or_non_sovereign_subject_holds = ROOT
							}
						}
						range = ROOT
                    }
                    save_event_target_as = th_purchase_province_1
                    set_province_flag = th_purchase_province_flag_1
                    region = {
                        limit = {
                            owned_by = FROM
                            NOT = { has_province_flag = th_purchase_province_flag_1 }
                        }
                        set_province_flag = th_purchase_province_flag_1
                    }
                }
                random_owned_province = {
                    limit = {
						is_capital = no
						has_port = yes
						NOT = {
							region_for_scope_province = {
								country_or_non_sovereign_subject_holds = ROOT
							}
						}
						range = ROOT
                        NOT = { has_province_flag = th_purchase_province_flag_1 }
                    }
                    save_event_target_as = th_purchase_province_2
                    set_province_flag = th_purchase_province_flag_2
                    region = {
                        limit = {
                            owned_by = FROM
                            NOT = { has_province_flag = th_purchase_province_flag_2 }
                        }
                        set_province_flag = th_purchase_province_flag_2
                    }
                }
                random_owned_province = {
                    limit = {
						is_capital = no
						has_port = yes
						NOT = {
							region_for_scope_province = {
								country_or_non_sovereign_subject_holds = ROOT
							}
						}
						range = ROOT
                        NOT = { has_province_flag = th_purchase_province_flag_1 }
                        NOT = { has_province_flag = th_purchase_province_flag_2 }
                    }
                    save_event_target_as = th_purchase_province_3
                    set_province_flag = th_purchase_province_flag_3
                    region = {
                        limit = {
                            owned_by = FROM
                            NOT = { has_province_flag = th_purchase_province_flag_3 }
                        }
                        set_province_flag = th_purchase_province_flag_3
                    }
                }
                random_owned_province = {
                    limit = {
						is_capital = no
						has_port = yes
						NOT = {
							region_for_scope_province = {
								country_or_non_sovereign_subject_holds = ROOT
							}
						}
						range = ROOT
                        NOT = { has_province_flag = th_purchase_province_flag_1 }
                        NOT = { has_province_flag = th_purchase_province_flag_2 }
                        NOT = { has_province_flag = th_purchase_province_flag_3 }
                    }
                    save_event_target_as = th_purchase_province_4
                    set_province_flag = th_purchase_province_flag_4
                    region = {
                        limit = {
                            owned_by = FROM
                            NOT = { has_province_flag = th_purchase_province_flag_4 }
                        }
                        set_province_flag = th_purchase_province_flag_4
                    }
                }
                random_owned_province = {
                    limit = {
						is_capital = no
						has_port = yes
						NOT = {
							region_for_scope_province = {
								country_or_non_sovereign_subject_holds = ROOT
							}
						}
						range = ROOT
                        NOT = { has_province_flag = th_purchase_province_flag_1 }
                        NOT = { has_province_flag = th_purchase_province_flag_2 }
                        NOT = { has_province_flag = th_purchase_province_flag_3 }
                        NOT = { has_province_flag = th_purchase_province_flag_4 }
                    }
                    save_event_target_as = th_purchase_province_5
                    set_province_flag = th_purchase_province_flag_5
                    region = {
                        limit = {
                            owned_by = FROM
                            NOT = { has_province_flag = th_purchase_province_flag_4 }
                        }
                        set_province_flag = th_purchase_province_flag_4
                    }
                }
            }
            export_to_variable = {
                which = th_money_to_give
                value = monthly_income
                who = ROOT
            }
            multiply_variable = {
                which = th_money_to_give
                value = 36
            }
        }
    }

    after = {
        clr_country_flag = th_has_trade_post_event_open
        FROM = {
            clr_country_flag = th_has_trade_deal_event
            every_owned_province = {
                clr_province_flag = th_purchase_province_flag_1
                clr_province_flag = th_purchase_province_flag_2
                clr_province_flag = th_purchase_province_flag_3
                clr_province_flag = th_purchase_province_flag_4
                clr_province_flag = th_purchase_province_flag_5
            }
        }
    }

    #Charter First Province
    option = {
        name = th_diplo_events.480.a
        trigger = { has_saved_event_target = th_purchase_province_1 }
        goto = th_purchase_province_1
        event_target:th_purchase_province_1 = {
            set_province_flag = th_purchase_province
            owner = {
                country_event = {
                    id = th_diplo_events.481
                }
            }
        }
        custom_tooltip = th_diplo_events.480.tt
        
        ai_chance = {
            factor = 100
        }
    }

    #Charter Second Province
    option = {
        name = th_diplo_events.480.b
        trigger = { has_saved_event_target = th_purchase_province_2 }
        goto = th_purchase_province_2
        event_target:th_purchase_province_2 = {
            set_province_flag = th_purchase_province
            owner = {
                country_event = {
                    id = th_diplo_events.481
                }
            }
        }
        custom_tooltip = th_diplo_events.480.tt
        
        ai_chance = {
            factor = 100
        }
    }

    #Charter Third Province
    option = {
        name = th_diplo_events.480.c
        trigger = { has_saved_event_target = th_purchase_province_3 }
        goto = th_purchase_province_3
        event_target:th_purchase_province_3 = {
            set_province_flag = th_purchase_province
            owner = {
                country_event = {
                    id = th_diplo_events.481
                }
            }
        }
        custom_tooltip = th_diplo_events.480.tt
        
        ai_chance = {
            factor = 100
        }
    }

    #Charter Fourth Province
    option = {
        name = th_diplo_events.480.d
        trigger = { has_saved_event_target = th_purchase_province_4 }
        goto = th_purchase_province_4
        event_target:th_purchase_province_4 = {
            set_province_flag = th_purchase_province
            owner = {
                country_event = {
                    id = th_diplo_events.481
                }
            }
        }
        custom_tooltip = th_diplo_events.480.tt
        
        ai_chance = {
            factor = 100
        }
    }

    #Charter Fifth Province
    option = {
        name = th_diplo_events.480.e
        trigger = { has_saved_event_target = th_purchase_province_5 }
        goto = th_purchase_province_5
        event_target:th_purchase_province_5 = {
            set_province_flag = th_purchase_province
            owner = {
                country_event = {
                    id = th_diplo_events.481
                }
            }
        }
        custom_tooltip = th_diplo_events.480.tt
        
        ai_chance = {
            factor = 100
        }
    }

    #No deal
    option = {
        name = th_diplo_events.480.f
        trigger = {
            OR = {
                has_saved_event_target = th_purchase_province_1
                has_saved_event_target = th_purchase_province_2
                has_saved_event_target = th_purchase_province_3
                has_saved_event_target = th_purchase_province_4
                has_saved_event_target = th_purchase_province_5
            }
        }
        FROM = {
            country_event = {
                id = th_diplo_events.482
            }
        }
        
        ai_chance = {
            factor = 100
        }
    }

    #Fallback - No province exists
    option = {
        name = th_diplo_events.480.g
        trigger = {
            NOT = { has_saved_event_target = th_purchase_province_1 }
            NOT = { has_saved_event_target = th_purchase_province_2 }
            NOT = { has_saved_event_target = th_purchase_province_3 }
            NOT = { has_saved_event_target = th_purchase_province_4 }
            NOT = { has_saved_event_target = th_purchase_province_5 }
        }
        
        ai_chance = {
            factor = 100
        }
    }
}

#Trade Post Charter - FROM - Think about deal
country_event = {
    id = th_diplo_events.481
    title = th_diplo_events.481.t
    desc = th_diplo_events.481.desc
    picture = RINNOSUKE_eventPicture
    is_triggered_only = yes
    immediate = {
        hidden_effect = {
            random_owned_province = {
                limit = {
                    has_province_flag = th_purchase_province
                }
                clr_province_flag = th_purchase_province
                save_event_target_as = th_purchase_province_target
            }
            export_to_variable = {
                which = th_money_to_gain
                value = monthly_income
                who = FROM
            }
            multiply_variable = {
                which = th_money_to_gain
                value = 36
            }
        }
    }

    #Accept the deal
    option = {
        name = th_diplo_events.481.a
        goto = th_purchase_province_target
        event_target:th_purchase_province_target = {
            cede_province = FROM
            add_to_trade_company = FROM
            if = {
                limit = { is_core = ROOT }
                remove_core = ROOT
            }
        }
        custom_tooltip = th_diplo_events.481.a.tt
        FROM = {
            country_event = {
                id = th_diplo_events.483
            }
        }
        
        ai_chance = {
            factor = 100
        }
    }

    #Decline the deal
    option = {
        name = th_diplo_events.481.b
        FROM = {
            country_event = {
                id = th_diplo_events.484
            }
        }
        
        ai_chance = {
            factor = 0
        }
    }
}

#Trade Post Charter - FROM - No deal
country_event = {
    id = th_diplo_events.482
    title = th_diplo_events.482.t
    desc = th_diplo_events.482.desc
    picture = RINNOSUKE_eventPicture
    is_triggered_only = yes

    #Accept the deal
    option = {
        name = th_diplo_events.482.a
        
        ai_chance = {
            factor = 100
        }
    }
}

#Trade Post Charter - ROOT - Has deal
country_event = {
    id = th_diplo_events.483
    title = th_diplo_events.483.t
    desc = th_diplo_events.483.desc
    picture = RINNOSUKE_eventPicture
    is_triggered_only = yes
    immediate = {
        hidden_effect = {
            export_to_variable = {
                which = th_money_to_transfer
                value = monthly_income
                who = ROOT
            }
            multiply_variable = {
                which = th_money_to_transfer
                value = 36
            }
        }
    }

    #Accept the deal
    option = {
        name = th_diplo_events.483.a
        custom_tooltip = th_diplo_events.483.a.tt
        th_transfer_treasury = {
            giver = ROOT
            taker = FROM
            variable = th_money_to_transfer
        }
        
        ai_chance = {
            factor = 100
        }
    }
}

#Trade Post Charter - ROOT - No deal
country_event = {
    id = th_diplo_events.484
    title = th_diplo_events.484.t
    desc = th_diplo_events.484.desc
    picture = RINNOSUKE_eventPicture
    is_triggered_only = yes

    #Accept the deal
    option = {
        name = th_diplo_events.484.a
        
        ai_chance = {
            factor = 100
        }
    }
}

#Purchase War Support - Start
country_event = {
    id = th_diplo_events.49
    title = none
    desc = none
    picture = none
    is_triggered_only = yes
    hidden = yes

    option = {
        FROM = {
            country_event = {
                id = th_diplo_events.490
            }
        }
        
        ai_chance = {
            factor = 100
        }
    }
}

#Purchase War Support - ROOT
country_event = {
    id = th_diplo_events.490
    title = th_diplo_events.490.t
    desc = th_diplo_events.490.desc
    picture = RINNOSUKE_eventPicture
    is_triggered_only = yes

    immediate = {
        hidden_effect = {
            export_to_variable = {
                which = th_money_to_give
                value = monthly_income
                who = ROOT
            }
            multiply_variable = {
                which = th_money_to_give
                value = 60
            }
        }
    }

    #Pay From
    option = {
        name = th_diplo_events.490.a
        custom_tooltip = th_diplo_events.490.tt
        FROM = {
            tooltip = {
                join_all_offensive_wars_of = ROOT
                join_all_defensive_wars_of = ROOT
            }
            country_event = {
                id = th_diplo_events.491
            }
        }
        th_transfer_treasury = {
            giver = ROOT
            taker = FROM
            variable = th_money_to_give
        }
        
        ai_chance = {
            factor = 100
        }
    }
}

#Purchase War Support - FROM
country_event = {
    id = th_diplo_events.491
    title = th_diplo_events.491.t
    desc = th_diplo_events.491.desc
    picture = RINNOSUKE_eventPicture
    is_triggered_only = yes

    immediate = {
        hidden_effect = {
            export_to_variable = {
                which = th_money_to_get
                value = monthly_income
                who = FROM
            }
            multiply_variable = {
                which = th_money_to_get
                value = 60
            }
        }
    }

    #Join ROOT
    option = {
        name = th_diplo_events.491.a
        custom_tooltip = th_diplo_events.491.tt
        join_all_offensive_wars_of = FROM
        join_all_defensive_wars_of = FROM
        
        ai_chance = {
            factor = 100
        }
    }
}

#Purchase Truce - Start
country_event = {
    id = th_diplo_events.50
    title = none
    desc = none
    picture = none
    is_triggered_only = yes
    hidden = yes

    option = {
        FROM = {
            country_event = {
                id = th_diplo_events.500
            }
        }
        
        ai_chance = {
            factor = 100
        }
    }
}

#Purchase War Support - ROOT
country_event = {
    id = th_diplo_events.500
    title = th_diplo_events.500.t
    desc = th_diplo_events.500.desc
    picture = RINNOSUKE_eventPicture
    is_triggered_only = yes

    immediate = {
        hidden_effect = {
            export_to_variable = {
                which = th_money_to_give
                value = monthly_income
                who = ROOT
            }
            multiply_variable = {
                which = th_money_to_give
                value = 48
            }
        }
    }

    #Pay From
    option = {
        name = th_diplo_events.500.a
        custom_tooltip = th_diplo_events.490.tt
        FROM = {
            tooltip = {
                add_truce_with = ROOT
            }
            country_event = {
                id = th_diplo_events.501
            }
        }
        th_transfer_treasury = {
            giver = ROOT
            taker = FROM
            variable = th_money_to_give
        }
        
        ai_chance = {
            factor = 100
        }
    }
}

#Purchase War Support - FROM
country_event = {
    id = th_diplo_events.501
    title = th_diplo_events.501.t
    desc = th_diplo_events.501.desc
    picture = RINNOSUKE_eventPicture
    is_triggered_only = yes

    immediate = {
        hidden_effect = {
            export_to_variable = {
                which = th_money_to_get
                value = monthly_income
                who = FROM
            }
            multiply_variable = {
                which = th_money_to_get
                value = 48
            }
        }
    }

    #Join ROOT
    option = {
        name = th_diplo_events.501.a
        custom_tooltip = th_diplo_events.491.tt
        add_truce_with = FROM
        
        ai_chance = {
            factor = 100
        }
    }
}

#Information about Tengu selling newspaper in your country
country_event = {
	id = th_diplo_events.51
	title = th_diplo_events.51.t
	desc = th_diplo_events.51.desc
	picture = AYAPAPERNEWS_eventPicture
	
    is_triggered_only = yes
    
    immediate = {
        hidden_effect = {
            export_to_variable = {
                which = th_money_to_transfer
                value = monthly_income
                who = ROOT
            }            
            export_to_variable = {
                which = th_money_available
                value = treasury
                who = ROOT
            }
            multiply_variable = {
                which = th_money_to_transfer
                value = 6
            }
            if = {
                limit = {
                    # Is th_money_to_transfer greater than th_money_available
                    check_variable = {
                        which = th_money_to_transfer
                        which = th_money_available
                    }
                }                
                # Set th_money_to_transfer to th_money_available's value, as th_money_to_transfer was greater than th_money_available
                set_variable = {
                    which = th_money_to_transfer 
                    which = th_money_available 
                }
            }
            set_variable = {
                which = th_money_report
                which = th_money_to_transfer 
            }
        }
    }
	
	option = {
        name = th_diplo_events.51.a
        custom_tooltip = th_diplo_events.51.a.tt
        th_transfer_treasury = {
            giver = ROOT
            taker = FROM
            variable = th_money_to_transfer
        }
        capital_scope = {
            add_next_institution_embracement = 5
        }
        change_government_reform_progress = 20
        hidden_effect = {
            FROM = {
                country_event = {
                    id = th_diplo_events.52
                }
            }
        }
		
		ai_chance = { 
			factor = 100
		}
    }
}

#Feedback of the sells
country_event = {
	id = th_diplo_events.52
	title = th_diplo_events.52.t
	desc = th_diplo_events.52.desc
	picture = AYAPAPERNEWS_eventPicture
	
    is_triggered_only = yes
	
	option = {
        name = th_diplo_events.52.a
        custom_tooltip = th_diplo_events.52.a.tt
		
		ai_chance = { 
			factor = 100
		}
	}
}

#Feedback of the sells
country_event = {
	id = th_diplo_events.53
	title = th_diplo_events.53.t
	desc = th_diplo_events.53.desc
	picture = AYAPAPERNEWS_eventPicture
	
    is_triggered_only = yes
    
    immediate = {
        hidden_effect = {
            FROM = {
                export_to_variable = {
                    which = th_money_to_transfer
                    value = monthly_income
                    who = FROM
                }
                multiply_variable = {
                    which = th_money_to_transfer
                    value = 3
                }
            }
            export_to_variable = {
                which = th_money_report
                value = monthly_income
                who = FROM
            }
            multiply_variable = {
                which = th_money_report
                value = 3
            }
        }
    }
	
	option = {
        name = th_diplo_events.53.a
        custom_tooltip = th_diplo_events.53.a.tt
        th_transfer_treasury = {
            giver = FROM
            taker = ROOT
            variable = th_money_to_transfer
        }
        FROM = {
            add_favors = {
                who = ROOT
                amount = 5
            }
        }
        add_trust = {
            who = FROM
            value = 5
        }
        add_opinion = {
			who = FROM
			modifier = th_bought_our_newspaper
		}
		
		ai_chance = { 
			factor = 100
		}
	}
}

#Gossip about [Root.Monarch.GetName]!
country_event = {
	id = th_diplo_events.54
	title = th_diplo_events.54.t
	desc = th_diplo_events.54.desc
	picture = AYAPAPERNEWS_eventPicture
	
    is_triggered_only = yes
    
    immediate = {
        hidden_effect = {
            set_country_flag = tgu_has_gossip_event_open
        }
    }
	
	option = {
        name = th_diplo_events.54.a
        add_ruler_modifier = {
            name = th_gossip_about_rulership
            duration = 1825
        }
        clr_country_flag = tgu_has_gossip_event_open
		
		ai_chance = { 
			factor = 100
		}
	}
}

#Lunarian Weapon lending - FROM
country_event = {
	id = th_diplo_events.55
	title = th_diplo_events.55.t
	desc = th_diplo_events.55.desc
	picture = LUNAR_DIPLOMACY_eventPicture
	goto = th_neighbor_war_country_capital
    is_triggered_only = yes
    
    immediate = {
        hidden_effect = {
            random_neighbor_country = {
                limit = {
                    NOT = { tag = FROM }
                    NOT = { is_subject_of = ROOT }
                    NOT = { is_subject_of = FROM }
                }
                save_event_target_as = th_neighbor_war_country
                capital_scope = {
                    save_event_target_as = th_neighbor_war_country_capital
                }
            }
        }
    }
	
	option = {
        name = th_diplo_events.55.a
        change_technology_group = tech_lunarian
        change_unit_type = tech_lunarian
        if = {
            limit = {
                has_saved_event_target = th_neighbor_war_country
            }
            set_country_flag = th_lended_weapons_and_war
            event_target:th_neighbor_war_country = {
                ROOT = {
                    declare_war = PREV
                }
            }
        }
        else = {
            clr_country_flag = th_lended_lunarian_weapons_from_@FROM
            FROM = {
                hidden_effect = {
                    country_event = {
                        id = th_diplo_events.56
                    }
                }
                tooltip = {
                    create_subject = {
                        subject_type = th_lunar_satellite
                        subject = ROOT
                    }
                }
            }
        }
		
		ai_chance = { 
			factor = 100
		}
	}
}

#Lunarian Weapon lending - ROOT
country_event = {
	id = th_diplo_events.56
	title = th_diplo_events.56.t
	desc = th_diplo_events.56.desc
	picture = TOYOHIME2_eventPicture
    is_triggered_only = yes
	
	option = {
        name = th_diplo_events.56.a
        create_subject = {
            subject_type = th_lunar_satellite
            subject = FROM
        }
		
		ai_chance = { 
			factor = 100
		}
	}
}

#Information about Joon stealing from your treasury
country_event = {
	id = th_diplo_events.57
	title = none
	desc = none
	picture = JOON_eventPicture
    hidden = yes
    is_triggered_only = yes
    
    immediate = {
        hidden_effect = {
            FROM = {
                export_to_variable = {
                    which = th_money_to_give
                    value = monthly_income
                    who = FROM
                }
                multiply_variable = {
                    which = th_money_to_give
                    value = 12
                }
            }
        }
    }
	
	option = {
        th_transfer_treasury = {
            giver = FROM
            taker = ROOT
            variable = th_money_to_give
        }
        add_loan = {
            fixed_interest = 10
            duration = 600
        }
        add_loan = {
            fixed_interest = 10
            duration = 600
        }
        add_loan = {
            fixed_interest = 10
            duration = 600
        }
        add_loan = {
            fixed_interest = 10
            duration = 600
        }
        add_loan = {
            fixed_interest = 10
            duration = 600
        }
        add_loan = {
            fixed_interest = 10
            duration = 600
        }
        add_loan = {
            fixed_interest = 10
            duration = 600
        }
        add_loan = {
            fixed_interest = 10
            duration = 600
        }
        add_loan = {
            fixed_interest = 10
            duration = 600
        }
        add_loan = {
            fixed_interest = 10
            duration = 600
        }
		ai_chance = { 
			factor = 100
		}
    }
}

#Tenshi's taunt
country_event = {
	id = th_diplo_events.58
	title = th_diplo_events.58.t
	desc = th_diplo_events.58.desc
	picture = TENSHI_earthquake_eventPicture
    is_triggered_only = yes
    immediate = {
        hidden_effect = {
            FROM = {
                clr_country_flag = hvr_used_taunt
                set_country_flag = hvr_used_taunt
		    }
        }
    }

	option = {
        name = th_diplo_events.58.a
        declare_war_with_cb = {
            casus_belli = cb_tenshi_insult_war
            who = FROM            
        }
		ai_chance = { 
			factor = 100
		}
	}
    option = {
        name = th_diplo_events.58.b
		ai_chance = { 
			factor = 0
		}
	}
}