flr_slot1_branch = {
  slot = 1
  generic = no
  ai = yes
  potential = {
    OR = {
      tag = FLR
      AND = {
        tag = HLR
        was_tag = FLR
      }
    }
    NOT = {
      map_setup = map_setup_random
    }
  }
  has_country_shield = yes
  flr_restore_our_sovereignty = {
    icon = mission_touhou_flan_royal_fighter
    required_missions = {}
    position = 1
    trigger = {
      is_subject = no
      OR = {
        BUR = {
          war_with = ROOT
        }
        NOT = {
          exists = BUR
        }
      }
    }
    effect = {
      add_stability_or_adm_power_per_stab = {
        amount = 2
      }
      change_government_reform_progress = 100
      wallonia_area = {
        limit = {
          NOT = {
            is_permanent_claim = ROOT
          }
          NOT = {
            is_core = ROOT
          }
        }
        add_permanent_claim = ROOT
      }
      picardy_area = {
        limit = {
          NOT = {
            is_permanent_claim = ROOT
          }
          NOT = {
            is_core = ROOT
          }
        }
        add_permanent_claim = ROOT
      }
      add_country_modifier = {
        name = "th_FLR_legitimate_integration"
        duration = 9125
      }
      country_event = {
        id = flavor_flr.2
      }
    }
  }
  flr_dominance_in_low_countries = {
    icon = mission_have_two_subjects
    required_missions = {
      flr_restore_our_sovereignty
    }
    position = 2
    provinces_to_highlight = {
      owned_by = BUR
    }
    trigger = {
      OR = {
        AND = {
          total_development = BUR
          army_size = BUR
          prestige = BUR
        }
        NOT = {
          exists = BUR
        }
      }
    }
    effect = {
      low_countries_region = {
        limit = {
          NOT = {
            is_permanent_claim = ROOT
          }
          NOT = {
            is_core = ROOT
          }
        }
        add_permanent_claim = ROOT
      }
      181 = {
        if = {
          limit = {
            NOT = {
              is_permanent_claim = ROOT
            }
            NOT = {
              is_core = ROOT
            }
          }
          add_permanent_claim = ROOT
        }
      }
      191 = {
        if = {
          limit = {
            NOT = {
              is_permanent_claim = ROOT
            }
            NOT = {
              is_core = ROOT
            }
          }
          add_permanent_claim = ROOT
        }
      }
      custom_tooltip = flr_dominance_in_low_countries_tt
      if = {
        limit = {
          exists = BUR
          any_country = {
            is_subject_of = BUR
          }
        }
        BUR = {
          country_event = {
            id = flavor_flr.4
          }
        }
      }
      if = {
        limit = {
          exists = BUR
        }
        tooltip = {
          every_country = {
            limit = {
              is_subject_of = BUR
            }
            hidden_effect = {
              BUR = {
                free_vassal = prev
              }
            }
            ROOT = {
              vassalize = prev
            }
          }
        }
      }
    }
  }
  flr_hegemony_in_low_countries = {
    icon = mission_landsknecht_soldier
    required_missions = {
      flr_dominance_in_low_countries
    }
    position = 3
    provinces_to_highlight = {
      region = low_countries_region
      NOT = {
        country_or_non_sovereign_subject_holds = ROOT
      }
    }
    trigger = {
      num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
        value = 15
        region = low_countries_region
      }
    }
    effect = {
      add_country_modifier = {
        name = "th_FLR_hegemony_lowlands"
        duration = 9125
      }
    }
  }
  flr_stability_of_low_countries = {
    icon = imperial_capitals
    required_missions = {
      flr_hegemony_in_low_countries
    }
    position = 4
    trigger = {
      custom_trigger_tooltip = {
        tooltip = flr_stability_of_low_countries_tt
        NOT = {
          any_owned_province = {
            region = low_countries_region
            unrest = 2
          }
        }
      }
      NOT = {
        num_of_loans = 1
      }
      manpower_percentage = 0.8
    }
    effect = {
      add_country_modifier = {
        name = "th_FLR_mistress_lowlands"
        duration = -1
      }
      north_westphalia_area = {
        limit = {
          NOT = {
            is_core = ROOT
          }
          NOT = {
            is_permanent_claim = ROOT
          }
        }
        add_permanent_claim = ROOT
      }
      westphalia_area = {
        limit = {
          NOT = {
            is_core = ROOT
          }
          NOT = {
            is_permanent_claim = ROOT
          }
        }
        add_permanent_claim = ROOT
      }
      north_rhine_area = {
        limit = {
          NOT = {
            is_core = ROOT
          }
          NOT = {
            is_permanent_claim = ROOT
          }
        }
        add_permanent_claim = ROOT
      }
      lower_rhineland_area = {
        limit = {
          NOT = {
            is_core = ROOT
          }
          NOT = {
            is_permanent_claim = ROOT
          }
        }
        add_permanent_claim = ROOT
      }
      braunschweig_area = {
        limit = {
          NOT = {
            is_core = ROOT
          }
          NOT = {
            is_permanent_claim = ROOT
          }
        }
        add_permanent_claim = ROOT
      }
      northern_saxony_area = {
        limit = {
          NOT = {
            is_core = ROOT
          }
          NOT = {
            is_permanent_claim = ROOT
          }
        }
        add_permanent_claim = ROOT
      }
      lower_saxony_area = {
        limit = {
          NOT = {
            is_core = ROOT
          }
          NOT = {
            is_permanent_claim = ROOT
          }
        }
        add_permanent_claim = ROOT
      }
      weser_area = {
        limit = {
          NOT = {
            is_core = ROOT
          }
          NOT = {
            is_permanent_claim = ROOT
          }
        }
        add_permanent_claim = ROOT
      }
    }
  }
  flr_threat_of_france = {
    icon = league_of_the_public_weal
    required_missions = {
      flr_stability_of_low_countries
    }
    position = 5
    trigger = {
      OR = {
        AND = {
          is_rival = FRA
          FRA = {
            is_rival = ROOT
          }
        }
        total_development = FRA
        FRA = {
          is_subject = yes
        }
        NOT = {
          exists = FRA
        }
      }
    }
    effect = {
      ile_de_france_area = {
        limit = {
          NOT = {
            is_core = ROOT
          }
          NOT = {
            is_permanent_claim = ROOT
          }
        }
        add_permanent_claim = ROOT
      }
      normandy_area = {
        limit = {
          NOT = {
            is_core = ROOT
          }
          NOT = {
            is_permanent_claim = ROOT
          }
        }
        add_permanent_claim = ROOT
      }
      champagne_area = {
        limit = {
          NOT = {
            is_core = ROOT
          }
          NOT = {
            is_permanent_claim = ROOT
          }
        }
        add_permanent_claim = ROOT
      }
      lorraine_area = {
        limit = {
          NOT = {
            is_core = ROOT
          }
          NOT = {
            is_permanent_claim = ROOT
          }
        }
        add_permanent_claim = ROOT
      }
    }
  }
}
flr_identity_branch = {
  slot = 1
  generic = no
  ai = yes
  potential = {
    OR = {
      tag = FLR
      AND = {
        tag = HLR
        was_tag = FLR
      }
    }
    NOT = {
      map_setup = map_setup_random
    }
  }
  has_country_shield = yes
  flr_build_the_scarlet_force = {
    icon = mission_touhou_army
    required_missions = {}
    position = 7
    trigger = {
      custom_trigger_tooltip = {
        tooltip = flr_first_flanclone_tt
        has_country_flag = flr_first_flanclone
      }
      is_subject = no
      army_size_percentage = 0.65
    }
    effect = {
      custom_tooltip = flr_build_the_scarlet_force_tt
      hidden_effect = {
        remove_country_modifier = th_flr_lvl1_flan
        add_country_modifier = {
          name = flr_lvl2_flan
          duration = -1
        }
      }
      add_country_modifier = {
        name = flr_scarlet_army
        duration = 7300
      }
    }
  }
  flr_get_the_estates_under_control = {
    icon = mission_alliances
    required_missions = {
      flr_build_the_scarlet_force
    }
    position = 8
    trigger = {
      crown_land_share = 45
      legitimacy = 95
      prestige = 30
    }
    effect = {
      custom_tooltip = flr_get_the_estates_under_control_tt
      hidden_effect = {
        remove_country_modifier = flr_lvl2_flan
        add_country_modifier = {
          name = flr_lvl3_flan
          duration = -1
        }
      }
      th_remove_autonomy_from_all_provinces_effect = yes
      add_country_modifier = {
        name = "hegemonic_ambition"
        duration = 7300
      }
    }
  }
  flr_learn_about_economics = {
    icon = mission_high_income
    required_missions = {
      flr_get_the_estates_under_control
    }
    position = 9
    trigger = {
      government_rank = 2
      share_of_starting_income = 7.5
      treasury = 1500
    }
    effect = {
      custom_tooltip = flr_learn_about_economics_tt
      hidden_effect = {
        remove_country_modifier = flr_lvl3_flan
        add_country_modifier = {
          name = flr_lvl4_flan
          duration = -1
        }
      }
      add_country_modifier = {
        name = "growing_economy"
        duration = 7300
      }
      add_country_modifier = {
        name = "strong_treasury"
        duration = 7300
      }
    }
  }
  flr_the_imperial_test = {
    icon = mission_touhou_pro_flan_throne
    required_missions = {
      flr_learn_about_economics
    }
    position = 10
    provinces_to_highlight = {
      region_for_scope_province = {
        is_capital_of = ROOT
      }
      NOT = {
        owned_by = ROOT
      }
    }
    trigger = {
      OR = {
        government_rank = 3
        is_emperor = yes
      }
      capital_scope = {
        region_for_scope_province = {
          type = all
          owned_by = ROOT
        }
      }
    }
    effect = {
      custom_tooltip = flr_the_imperial_test_tt
      hidden_effect = {
        override_country_name = FLANDRISH_EMPIRE
        set_country_flag = flr_is_flandrish_empire
        remove_country_modifier = flr_lvl4_flan
        add_country_modifier = {
          name = flr_lvl5_flan
          duration = -1
        }
      }
      add_dip_power = 50
      add_adm_power = 50
      add_mil_power = 50
      add_country_modifier = {
        name = "hegemonic_ambition"
        duration = 9125
      }
    }
  }
}
flr_religion_branch = {
  slot = 2
  generic = no
  ai = yes
  potential = {
    OR = {
      tag = FLR
      AND = {
        tag = HLR
        was_tag = FLR
      }
    }
    NOT = {
      map_setup = map_setup_random
    }
  }
  has_country_shield = yes
  flr_question_of_religious_direction = {
    icon = rhineland_conquest
    required_missions = {
      flr_get_used_to_europe
    }
    position = 2
    trigger = {
      custom_trigger_tooltip = {
        tooltip = flr_question_of_religious_direction_trigger
        has_country_flag = flr_has_made_the_choice
      }
      is_year = 1500
    }
    effect = {
      add_legitimacy = 15
      custom_tooltip = flr_question_of_religious_direction_tt
      hidden_effect = {
        if = {
          limit = {
            has_country_flag = flr_catholic_path
          }
          clr_country_flag = flr_catholic_path
          set_country_flag = flr_catholic_path_mission
        }
        if = {
          limit = {
            has_country_flag = flr_reformation_path
          }
          set_country_flag = flr_reformation_path_mission
        }
        if = {
          limit = {
            has_country_flag = flr_shinto_path
          }
          clr_country_flag = flr_shinto_path
          set_country_flag = flr_shinto_path_mission
        }
        if = {
          limit = {
            has_country_flag = flr_tolerance_path
          }
          clr_country_flag = flr_tolerance_path
          set_country_flag = flr_tolerance_path_mission
        }
        swap_non_generic_missions = yes
      }
    }
  }
}
flr_catholic_branch = {
  slot = 2
  generic = no
  ai = yes
  potential = {
    OR = {
      tag = FLR
      AND = {
        tag = HLR
        was_tag = FLR
      }
    }
    NOT = {
      map_setup = map_setup_random
    }
    has_country_flag = flr_catholic_path_mission
  }
  has_country_shield = yes
  flr_praise_man_with_funny_hat = {
    icon = mission_touhou_pope
    required_missions = {
      flr_question_of_religious_direction
    }
    position = 3
    trigger = {
      OR = {
        PAP = {
          has_opinion = {
            who = ROOT
            value = 150
          }
        }
        NOT = {
          exists = PAP
        }
      }
    }
    effect = {
      add_papal_influence = 100
    }
  }
  flr_hre_win_for_catholicism = {
    icon = crush_heretic_strongholds
    required_missions = {
      flr_praise_man_with_funny_hat
    }
    position = 4
    trigger = {
      OR = {
        NOT = {
          hre_size = 1
        }
        AND = {
          hre_religion_locked = yes
          hre_religion = catholic
        }
      }
    }
    effect = {
      custom_tooltip = flr_religious_war_tt
      if = {
        limit = {
          th_has_won_the_religious_war = yes
        }
        add_country_modifier = {
          name = flr_teachings_of_the_war
          duration = 9125
        }
      }
      if = {
        limit = {
          is_emperor = yes
        }
        add_imperial_influence = 25
      }
      else = {
        add_mil_power = 100
      }
      add_country_modifier = {
        name = flr_catholic_supramacy
        duration = 7300
      }
    }
  }
}
flr_reformation_branch = {
  slot = 2
  generic = no
  ai = yes
  potential = {
    OR = {
      tag = FLR
      AND = {
        tag = HLR
        was_tag = FLR
      }
    }
    NOT = {
      map_setup = map_setup_random
    }
    has_country_flag = flr_reformation_path_mission
  }
  has_country_shield = yes
  flr_become_defender_of_reformation = {
    icon = mission_luther_theses
    required_missions = {
      flr_question_of_religious_direction
    }
    position = 3
    trigger = {
      is_defender_of_faith = yes
      OR = {
        religion = protestant
        religion = reformed
      }
      OR = {
        calc_true_if = {
          all_country = {
            religion = ROOT
          }
          amount = 15
        }
        calc_true_if = {
          all_province = {
            religion = ROOT
          }
          amount = 100
        }
      }
    }
    effect = {
      add_church_power = 200
      add_fervor = 100
      add_country_modifier = {
        name = flr_protestant_mission
        duration = 9125
      }
    }
  }
  flr_hre_win_for_reformation = {
    icon = mission_rb_control_state_religion
    required_missions = {
      flr_become_defender_of_reformation
    }
    position = 4
    trigger = {
      OR = {
        NOT = {
          hre_size = 1
        }
        AND = {
          hre_religion_locked = yes
          OR = {
            hre_religion = protestant
            hre_religion = reformed
          }
        }
      }
    }
    effect = {
      custom_tooltip = flr_religious_war_tt
      if = {
        limit = {
          th_has_won_the_religious_war = yes
        }
        add_country_modifier = {
          name = flr_teachings_of_the_war
          duration = 9125
        }
      }
      if = {
        limit = {
          is_emperor = yes
        }
        add_imperial_influence = 25
      }
      else = {
        add_mil_power = 100
      }
      add_country_modifier = {
        name = flr_reformed_supremacy
        duration = 7300
      }
    }
  }
}
flr_shinto_branch = {
  slot = 2
  generic = no
  ai = yes
  potential = {
    OR = {
      tag = FLR
      AND = {
        tag = HLR
        was_tag = FLR
      }
    }
    NOT = {
      map_setup = map_setup_random
    }
    has_country_flag = flr_shinto_path_mission
  }
  has_country_shield = yes
  flr_build_shinto_shrines = {
    icon = mission_touhou_shrines
    required_missions = {
      flr_question_of_religious_direction
    }
    position = 3
    trigger = {
      calc_true_if = {
        all_known_country = {
          religion_group = Touhou
          OR = {
            alliance_with = ROOT
            is_subject_of = ROOT
          }
        }
        amount = 3
      }
      OR = {
        calc_true_if = {
          all_country = {
            technology_group = western
            religion_group = Touhou
          }
          amount = 15
        }
        calc_true_if = {
          all_province = {
            religion_group = Touhou
            continent = europe
          }
          amount = 70
        }
      }
    }
    effect = {
      add_dip_power = 150
      custom_tooltip = flr_gain_claims_over_vampire_hunters
      hidden_effect = {
        236 = {
          if = {
            limit = {
              NOT = {
                is_core = ROOT
              }
              NOT = {
                is_permanent_claim = ROOT
              }
            }
            add_permanent_claim = ROOT
          }
        }
        112 = {
          if = {
            limit = {
              NOT = {
                is_core = ROOT
              }
              NOT = {
                is_permanent_claim = ROOT
              }
            }
            add_permanent_claim = ROOT
          }
        }
        transylvania_area = {
          limit = {
            NOT = {
              is_core = ROOT
            }
            NOT = {
              is_permanent_claim = ROOT
            }
          }
          add_permanent_claim = ROOT
        }
        southern_transylvania_area = {
          limit = {
            NOT = {
              is_core = ROOT
            }
            NOT = {
              is_permanent_claim = ROOT
            }
          }
          add_permanent_claim = ROOT
        }
      }
      add_country_modifier = {
        name = flr_shinto_missoinaries
        duration = 9125
      }
    }
  }
  flr_hunt_the_hunters = {
    icon = mission_touhou_hellsing
    required_missions = {
      flr_build_shinto_shrines
    }
    position = 4
    provinces_to_highlight = {
      OR = {
        province_id = 236
        province_id = 112
        province_id = 4127
      }
      NOT = {
        country_or_non_sovereign_subject_holds = ROOT
      }
    }
    trigger = {
      custom_trigger_tooltip = {
        tooltip = flr_hunt_the_hunters_trigger
        calc_true_if = {
          all_province = {
            continent = europe
            religion_group = Touhou
          }
          amount = 120
        }
      }
      owns_or_non_sovereign_subject_of = 236
      owns_or_non_sovereign_subject_of = 112
      owns_or_non_sovereign_subject_of = 4127
    }
    effect = {
      th_allow_shorter_deity_swapping = yes
      add_country_modifier = {
        name = flr_shinto_supremacy
        duration = 9125
      }
    }
  }
}
flr_tolerant_branch = {
  slot = 2
  generic = no
  ai = yes
  potential = {
    OR = {
      tag = FLR
      AND = {
        tag = HLR
        was_tag = FLR
      }
    }
    NOT = {
      map_setup = map_setup_random
    }
    has_country_flag = flr_tolerance_path_mission
  }
  has_country_shield = yes
  flr_religious_war = {
    icon = back_the_league
    required_missions = {
      flr_question_of_religious_direction
    }
    position = 3
    trigger = {
      OR = {
        has_idea = FLR_flans_own_empire
        has_idea_group = humanist_ideas
        has_idea_group = innovativeness_ideas
      }
      any_ally = {
        NOT = {
          religion = ROOT
        }
      }
    }
    effect = {
      add_country_modifier = {
        name = flr_tolerance_view
        duration = 9125
      }
    }
  }
  flr_convince_emperor_of_religious_peace = {
    icon = mission_touhou_flan_peace
    required_missions = {
      flr_religious_war
    }
    position = 4
    trigger = {
      OR = {
        NOT = {
          hre_size = 1
        }
        hre_leagues_enabled = yes
        hre_religion_treaty = yes
      }
    }
    effect = {
      if = {
        limit = {
          hre_leagues_enabled = yes
        }
        if = {
          limit = {
            is_emperor = no
          }
          emperor = {
            country_event = {
              id = flavor_flr.13
            }
          }
        }
        else_if = {
          limit = {
            is_emperor = yes
          }
          country_event = {
            id = flavor_flr.14
          }
        }
      }
      add_country_modifier = {
        name = flr_tolerant_reformer_of_the_hre
        duration = 9125
      }
    }
  }
}
flr_vampiric_branch = {
  slot = 4
  generic = no
  ai = yes
  potential = {
    OR = {
      tag = FLR
      AND = {
        tag = HLR
        was_tag = FLR
      }
    }
    NOT = {
      map_setup = map_setup_random
    }
  }
  has_country_shield = yes
  flr_create_the_scarlet_navy = {
    icon = mission_establish_high_seas_navy
    required_missions = {
      flr_trade_north_sea
    }
    position = 2
    trigger = {
      num_of_heavy_ship = 10
      if = {
        limit = {
          has_dlc = "Golden Century"
        }
        has_flagship = yes
      }
    }
    effect = {
      add_country_modifier = {
        name = "naval_enthusiasm_mission"
        duration = 9125
      }
      home_counties_area = {
        limit = {
          NOT = {
            is_core = ROOT
          }
          NOT = {
            is_permanent_claim = ROOT
          }
        }
        add_permanent_claim = ROOT
      }
    }
  }
  flr_first_clue_scarlet = {
    icon = mission_rb_control_the_hansa
    required_missions = {
      flr_create_the_scarlet_navy
    }
    position = 3
    provinces_to_highlight = {
      province_id = 236
      NOT = {
        country_or_non_sovereign_subject_holds = ROOT
      }
    }
    trigger = {
      OR = {
        owns_or_non_sovereign_subject_of = 236
        custom_trigger_tooltip = {
          tooltip = flr_first_clue_scarlet_trigger
          236 = {
            owner = {
              NOT = {
                is_subject_of = ROOT
              }
              has_opinion = {
                who = ROOT
                value = 150
              }
            }
          }
        }
      }
    }
    effect = {
      custom_tooltip = flr_first_clue_scarlet_tt
      hidden_effect = {
        if = {
          limit = {
            owns_or_non_sovereign_subject_of = 236
          }
          add_adm_power = 100
          add_country_modifier = {
            name = "imperial_ambition"
            duration = 9125
          }
        }
        else = {
          add_dip_power = 100
          add_country_modifier = {
            name = "influential_diplomacy"
            duration = 9125
          }
        }
      }
      country_event = {
        id = flavor_flr.10
      }
    }
  }
  flr_origin_of_vampirism = {
    icon = mission_touhou_stone_mask
    required_missions = {
      flr_first_clue_scarlet
    }
    position = 4
    trigger = {
      home_trade_node = {
        trade_share = {
          country = ROOT
          share = 75
        }
      }
    }
    effect = {
      country_event = {
        id = flavor_flr.11
      }
      th_get_default_permanent_province_buff = yes
    }
  }
}
flr_slot2_branch = {
  slot = 2
  generic = no
  ai = yes
  potential = {
    OR = {
      tag = FLR
      AND = {
        tag = HLR
        was_tag = FLR
      }
    }
    NOT = {
      map_setup = map_setup_random
    }
  }
  has_country_shield = yes
  flr_entrance_of_north_germany = {
    icon = mission_cannons_firing
    required_missions = {
      flr_stability_of_low_countries
    }
    position = 5
    provinces_to_highlight = {
      OR = {
        area = north_westphalia_area
        area = westphalia_area
        area = braunschweig_area
        area = weser_area
        area = northern_saxony_area
        area = lower_saxony_area
      }
      NOT = {
        country_or_non_sovereign_subject_holds = ROOT
      }
    }
    trigger = {
      num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
        value = 6
        OR = {
          area = north_westphalia_area
          area = westphalia_area
          area = braunschweig_area
          area = weser_area
          area = northern_saxony_area
          area = lower_saxony_area
        }
      }
    }
    effect = {
      add_country_modifier = {
        name = th_FLR_saxony_conquest
        duration = 5475
      }
      mecklenburg_area = {
        limit = {
          NOT = {
            is_core = ROOT
          }
          NOT = {
            is_permanent_claim = ROOT
          }
        }
        add_permanent_claim = ROOT
      }
      mittelmark_area = {
        limit = {
          NOT = {
            is_core = ROOT
          }
          NOT = {
            is_permanent_claim = ROOT
          }
        }
        add_permanent_claim = ROOT
      }
      neumark_area = {
        limit = {
          NOT = {
            is_core = ROOT
          }
          NOT = {
            is_permanent_claim = ROOT
          }
        }
        add_permanent_claim = ROOT
      }
      if = {
        limit = {
          BRA = {
            is_subject = NO
          }
        }
        add_casus_belli = {
          target = BRA
          type = cb_vassalize_mission
          months = 900
        }
      }
      if = {
        limit = {
          PRU = {
            is_subject = NO
            was_tag = BRA
          }
        }
        add_casus_belli = {
          target = PRU
          type = cb_vassalize_mission
          months = 900
        }
      }
    }
  }
  flr_brandenburg_electorate = {
    icon = electorate_of_brandenburg
    required_missions = {
      flr_entrance_of_north_germany
    }
    provinces_to_highlight = {
      province_id = 50
    }
    position = 6
    trigger = {
      50 = {
        country_or_non_sovereign_subject_holds = ROOT
      }
    }
    effect = {
      add_country_modifier = {
        name = th_FLR_brandenburg_army
        duration = -1
      }
      north_german_region = {
        limit = {
          NOT = {
            is_core = ROOT
          }
          NOT = {
            is_permanent_claim = ROOT
          }
        }
        add_permanent_claim = ROOT
      }
      if = {
        limit = {
          is_part_of_hre = yes
          is_elector = no
          BRA = {
            is_elector = yes
          }
        }
        country_event = {
          id = flavor_flr.5
        }
      }
    }
  }
  flr_war_preparation = {
    icon = mission_assemble_an_army
    required_missions = {
      flr_build_the_scarlet_force
    }
    position = 8
    trigger = {
      if = {
        limit = {
          has_dlc = "Cradle of Civilization"
        }
        army_professionalism = 0.20
      }
      has_global_modifier_value = {
        which = discipline
        value = 0.1
      }
    }
    effect = {
      add_country_modifier = {
        name = "th_FLR_war_preparation"
        duration = 7300
      }
    }
  }
  flr_professional_army = {
    icon = army_reforms
    required_missions = {
      flr_war_preparation
    }
    position = 9
    trigger = {
      if = {
        limit = {
          has_dlc = "Cradle of Civilization"
        }
        army_professionalism = 0.50
      }
      has_global_modifier_value = {
        which = discipline
        value = 0.2
      }
    }
    effect = {
      add_country_modifier = {
        name = "th_FLR_professional_army"
        duration = 7300
      }
    }
  }
  flr_controlled_army = {
    icon = balance_the_estates
    required_missions = {
      flr_professional_army
    }
    position = 10
    trigger = {
      if = {
        limit = {
          has_dlc = "Cradle of Civilization"
        }
        army_professionalism = 1
      }
      if = {
        limit = {
          has_estate = estate_nobles
        }
        NOT = {
          estate_influence = {
            estate = estate_nobles
            influence = 40
          }
        }
      }
    }
    effect = {
      add_country_modifier = {
        name = "th_FLR_controlled_army"
        duration = -1
      }
    }
  }
  flr_enlightened_mistress = {
    icon = mission_touhou_monarch_flan
    required_missions = {
      flr_controlled_army
      flr_the_imperial_test
    }
    position = 11
    trigger = {
      th_has_final_tier_reforms_trigger = yes
      if = {
        limit = {
          is_revolutionary = no
        }
        absolutism = 90
      }
      else = {
        revolutionary_zeal = 90
      }
      num_of_owned_provinces_with = {
        value = 10
        has_building = university
      }
    }
    effect = {
      th_increase_ruler_adm_stat = {
        adm = 1
      }
      add_country_modifier = {
        name = "th_FLR_enlightened_mistress"
        duration = -1
      }
    }
  }
}
flr_slot3_branch = {
  slot = 3
  generic = no
  ai = yes
  potential = {
    OR = {
      tag = FLR
      AND = {
        tag = HLR
        was_tag = FLR
      }
    }
    NOT = {
      map_setup = map_setup_random
    }
  }
  has_country_shield = yes
  flr_get_used_to_europe = {
    icon = mission_touhou_noobie_flan_throne
    required_missions = {}
    position = 1
    trigger = {
      OR = {
        custom_trigger_tooltip = {
          tooltip = th_flr_any_country_likes_us_tt
          any_country = {
            capital_scope = {
              superregion = europe_superregion
            }
            NOT = {
              overlord_of = ROOT
            }
            is_free_or_tributary_trigger = yes
            has_opinion = {
              who = ROOT
              value = 125
            }
          }
        }
        is_free_or_tributary_trigger = yes
      }
      has_advisor = yes
    }
    effect = {
      country_event = {
        id = flavor_scr.5
      }
      add_stability_or_adm_power_per_stab = {
        amount = 2
      }
    }
  }
  flr_diplomacy_with_germany = {
    icon = imperial_ascendancy
    required_missions = {
      flr_get_used_to_europe
    }
    position = 3
    trigger = {
      calc_true_if = {
        all_country = {
          OR = {
            is_subject_of = ROOT
            alliance_with = ROOT
          }
          custom_trigger_tooltip = {
            tooltip = flr_diplomacy_with_germany.tt
            capital_scope = {
              OR = {
                region = north_german_region
                region = south_german_region
              }
            }
          }
        }
        amount = 3
      }
    }
    effect = {
      add_prestige = 20
      th_increase_ruler_dip_stat = {
        dip = 1
      }
    }
  }
  flr_lex_salica = {
    icon = mission_touhou_queen_flan
    required_missions = {
      flr_diplomacy_with_germany
    }
    position = 4
    trigger = {
      has_global_modifier_value = {
        which = discipline
        value = 0.15
      }
      OR = {
        AND = {
          calc_true_if = {
            amount = 3
            all_elector = {
              has_opinion = {
                who = ROOT
                value = 100
              }
            }
          }
          diplomatic_reputation = 6
        }
        AND = {
          NOT = {
            hre_size = 1
          }
          NOT = {
            exists = HLR
          }
        }
      }
    }
    effect = {
      add_prestige = 40
      custom_tooltip = flr_lex_salica_tt
      if = {
        limit = {
          AND = {
            NOT = {
              hre_size = 1
            }
            NOT = {
              exists = HLR
            }
          }
        }
        country_event = {
          id = flavor_flr.31
        }
      }
      else = {
        country_event = {
          id = flavor_flr.3
        }
      }
    }
  }
  flr_hegemony_in_germany = {
    icon = ger_kaiserreich
    required_missions = {
      flr_brandenburg_electorate
    }
    position = 7
    trigger = {
      OR = {
        AND = {
          ROOT = {
            is_emperor = yes
            if = {
              limit = {
                has_dlc = "Emperor"
              }
              hre_reform_passed = emperor_perpetual_diet
            }
            else = {
              hre_reform_passed = landfriede
            }
          }
        }
        AND = {
          NOT = {
            exists = HLR
          }
          num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
            value = 41
            region = north_german_region
          }
        }
      }
    }
    effect = {
      south_german_region = {
        limit = {
          NOT = {
            is_core = ROOT
          }
          NOT = {
            is_permanent_claim = ROOT
          }
        }
        add_permanent_claim = ROOT
      }
      custom_tooltip = flr_hegemony_in_germany_tt
      if = {
        limit = {
          is_emperor = yes
        }
        add_country_modifier = {
          name = th_FLR_authority_kaiserin
          duration = 7300
        }
      }
      else = {
        add_country_modifier = {
          name = th_FLR_hegemony_germany
          duration = 7300
        }
      }
    }
  }
  flr_reunion_france = {
    icon = centralize_france
    required_missions = {
      flr_imperial_crown_of_germany
    }
    provinces_to_highlight = {
      region = france_region
      NOT = {
        country_or_non_sovereign_subject_holds = ROOT
      }
    }
    position = 9
    trigger = {
      num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
        value = 40
        region = france_region
      }
    }
    effect = {
      add_country_modifier = {
        name = th_FLR_reunion_france
        duration = 7300
      }
    }
  }
}
flr_slot4_branch = {
  slot = 4
  generic = no
  ai = yes
  potential = {
    OR = {
      tag = FLR
      AND = {
        tag = HLR
        was_tag = FLR
      }
    }
    NOT = {
      map_setup = map_setup_random
    }
  }
  has_country_shield = yes
  flr_beyond_the_rhine = {
    icon = rhineland_conquest
    required_missions = {
      flr_stability_of_low_countries
    }
    position = 5
    provinces_to_highlight = {
      OR = {
        area = north_westphalia_area
        area = westphalia_area
        area = north_rhine_area
        area = lower_rhineland_area
      }
      NOT = {
        country_or_non_sovereign_subject_holds = ROOT
      }
    }
    trigger = {
      num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
        value = 10
        OR = {
          area = north_westphalia_area
          area = westphalia_area
          area = north_rhine_area
          area = lower_rhineland_area
        }
      }
    }
    effect = {
      add_country_modifier = {
        name = th_FLR_rhineland_wealth
        duration = 7300
      }
    }
  }
  flr_imperial_crown_of_germany = {
    icon = spread_the_von_wettins
    required_missions = {
      flr_hegemony_in_germany
    }
    provinces_to_highlight = {
      OR = {
        region = north_german_region
        region = south_german_region
      }
      NOT = {
        country_or_non_sovereign_subject_holds = ROOT
      }
    }
    position = 8
    trigger = {
      OR = {
        tag = HLR
        AND = {
          is_emperor = yes
          if = {
            limit = {
              has_dlc = "Emperor"
            }
            OR = {
              hre_reform_passed = emperor_geteilte_macht
              hre_reform_passed = emperor_reichskrieg
            }
          }
          else = {
            hre_reform_passed = privilegia_de_non_appelando
          }
        }
        AND = {
          NOT = {
            exists = HLR
          }
          num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
            value = 100
            OR = {
              region = north_german_region
              region = south_german_region
            }
          }
        }
      }
    }
    effect = {
      france_region = {
        limit = {
          NOT = {
            is_core = ROOT
          }
          NOT = {
            is_permanent_claim = ROOT
          }
        }
        add_permanent_claim = ROOT
      }
      if = {
        limit = {
          FRA = {
            is_subject = NO
          }
        }
        add_casus_belli = {
          target = FRA
          type = cb_restore_personal_union
          months = 900
        }
      }
      italy_region = {
        limit = {
          NOT = {
            is_core = ROOT
          }
          NOT = {
            is_permanent_claim = ROOT
          }
        }
        add_permanent_claim = ROOT
      }
      balkan_region = {
        limit = {
          NOT = {
            is_core = root
          }
          NOT = {
            is_permanent_claim = root
          }
        }
        add_permanent_claim = root
      }
      custom_tooltip = emp_hab_take_wallachia_bulgaria_effect_tooltip
      hidden_effect = {
        europe = {
          limit = {
            owned_by = TUR
            NOT = {
              is_core = root
            }
            NOT = {
              is_permanent_claim = root
            }
            NOT = {
              region = anatolia_region
            }
            NOT = {
              region = caucasia_region
            }
            NOT = {
              region = balkan_region
            }
          }
          add_claim = root
        }
      }
      if = {
        limit = {
          is_emperor = no
          NOT = {
            government_rank = 3
          }
        }
        set_government_rank = 3
      }
      add_country_modifier = {
        name = th_FLR_keiserin_germany
        duration = -1
      }
    }
  }
  flr_guardian_of_europe = {
    icon = mission_ottoman_diplomacy
    required_missions = {
      flr_imperial_crown_of_germany
    }
    position = 9
    provinces_to_highlight = {
      owned_by = TUR
      continent = europe
      NOT = {
        region = anatolia_region
      }
      NOT = {
        region = caucasia_region
      }
    }
    trigger = {
      NOT = {
        europe = {
          custom_trigger_tooltip = {
            tooltip = emp_hab_scourge_of_europe_trigger_tooltip
            owned_by = TUR
            NOT = {
              region = anatolia_region
            }
            NOT = {
              region = caucasia_region
            }
          }
        }
      }
    }
    effect = {
      if = {
        limit = {
          religion_group = christian
        }
        add_country_modifier = {
          name = "th_FLR_guardian_europe"
          duration = 10950
        }
      }
      else = {
        add_country_modifier = {
          name = "th_FLR_terror_of_balkans"
          duration = 10950
        }
      }
    }
  }
  flr_mistress_of_europe = {
    icon = mission_touhou_judge_of_gensokyo
    required_missions = {
      flr_reunion_france
      flr_control_italy
      flr_guardian_of_europe
    }
    position = 10
    trigger = {
      NOT = {
        any_country = {
          total_own_and_non_tributary_subject_development = ROOT
        }
      }
      custom_trigger_tooltip = {
        tooltip = flr_mistress_of_europe.tt
        NOT = {
          any_country = {
            OR = {
              capital_scope = {
                continent = europe
              }
              capital_scope = {
                continent = gensokyo_continent
              }
            }
            army_size = ROOT
          }
        }
      }
    }
    effect = {
      add_country_modifier = {
        name = "th_FLR_mistress_europe"
        duration = -1
      }
      Scarlet_island = {
        limit = {
          NOT = {
            is_core = ROOT
          }
          NOT = {
            is_permanent_claim = ROOT
          }
        }
        add_permanent_claim = ROOT
      }
      Scarlett_domain = {
        limit = {
          NOT = {
            is_core = ROOT
          }
          NOT = {
            is_permanent_claim = ROOT
          }
        }
        add_permanent_claim = ROOT
      }
      Scarlet_mountain = {
        limit = {
          NOT = {
            is_core = ROOT
          }
          NOT = {
            is_permanent_claim = ROOT
          }
        }
        add_permanent_claim = ROOT
      }
      if = {
        limit = {
          OR = {
            AND = {
              exists = SCR
              SCR = {
                is_free_or_tributary_trigger = yes
              }
            }
            AND = {
              exists = SCD
              SCD = {
                is_free_or_tributary_trigger = yes
              }
            }
          }
        }
        country_event = {
          id = flavor_flr.60
        }
      }
    }
  }
  flr_homecoming = {
    icon = mission_touhou_empress_remilia
    required_missions = {
      flr_mistress_of_europe
    }
    position = 11
    provinces_to_highlight = {
      area = Scarlet_island
      NOT = {
        country_or_non_sovereign_subject_holds = ROOT
      }
    }
    trigger = {
      Scarlet_island = {
        type = all
        country_or_non_sovereign_subject_holds = ROOT
      }
      OR = {
        NOT = {
          exists = SCR
        }
        SCR = {
          is_subject_of = ROOT
        }
      }
      OR = {
        NOT = {
          exists = SCD
        }
        SCD = {
          is_subject_of = ROOT
        }
      }
    }
    effect = {
      add_country_modifier = {
        name = th_FLR_Scarlet_union
        duration = 18250
      }
      gensokyo_region = {
        limit = {
          NOT = {
            is_core = ROOT
          }
          NOT = {
            is_permanent_claim = ROOT
          }
        }
        add_permanent_claim = ROOT
      }
      former_hell_region = {
        limit = {
          NOT = {
            is_core = ROOT
          }
          NOT = {
            is_permanent_claim = ROOT
          }
        }
        add_permanent_claim = ROOT
      }
    }
  }
}
flr_slot5_branch = {
  slot = 5
  generic = no
  ai = yes
  potential = {
    OR = {
      tag = FLR
      AND = {
        tag = HLR
        was_tag = FLR
      }
    }
    NOT = {
      map_setup = map_setup_random
    }
  }
  has_country_shield = yes
  flr_trade_north_sea = {
    icon = support_the_bulk_trades
    required_missions = {}
    position = 1
    trigger = {
      num_of_total_ports = 9
      num_of_light_ship = 15
    }
    effect = {
      add_navy_tradition = 35
      add_country_modifier = {
        name = "th_FLR_trade_north"
        duration = 7300
      }
      define_explorer = {
        shock = 3
        fire = 3
        manuever = 3
        siege = 0
        name = "™‚pQ5g2—KN¢ci–¶RR«Ž"  # Flandres Clone Explorer
        female = yes
      }
    }
  }
  flr_new_world_routes = {
    icon = mission_rb_a_mighty_fleet
    required_missions = {
      flr_trade_north_sea
    }
    position = 2
    trigger = {
      OR = {
        north_america = {
          has_discovered = ROOT
        }
        south_america = {
          has_discovered = ROOT
        }
        guinea_region = {
          has_discovered = ROOT
        }
      }
    }
    effect = {
      add_country_modifier = {
        name = "th_FLR_desire_new_routes"
        duration = 7300
      }
    }
  }
  flr_trade_new_world = {
    icon = mission_african_gold
    required_missions = {
      flr_new_world_routes
    }
    position = 3
    trigger = {
      num_of_merchants = 4
      custom_trigger_tooltip = {
        tooltip = flr_trade_new_world.tt
        OR = {
          any_country = {
            AND = {
              is_subject_of = ROOT
              th_is_colony = yes
              num_of_owned_provinces_with = {
                value = 20
              }
            }
          }
          num_of_owned_provinces_with = {
            NOT = {
              continent = europe
            }
            is_node_in_trade_company_region = yes
            value = 20
          }
        }
      }
    }
    effect = {
      add_mercantilism = 5
      add_country_modifier = {
        name = "th_FLR_trade_new_world"
        duration = 7300
      }
    }
  }
  flr_economic_base = {
    icon = mission_colonial
    required_missions = {}
    position = 5
    trigger = {
      num_of_owned_provinces_with = {
        value = 5
        OR = {
          has_building = marketplace
          has_building = trade_depot
          has_building = stock_exchange
        }
      }
      num_of_owned_provinces_with = {
        value = 5
        OR = {
          has_building = workshop
          has_building = counting_house
        }
      }
    }
    effect = {
      add_mercantilism = 3
      if = {
        limit = {
          90 = {
            owned_by = ROOT
          }
        }
        90 = {
          add_province_modifier = {
            name = "th_FLR_economic_base"
            duration = 7300
          }
        }
      }
    }
  }
  flr_economic_support_army = {
    icon = mission_hanseatic_city
    required_missions = {
      flr_beyond_the_rhine
      flr_economic_base
    }
    position = 6
    trigger = {
      num_of_owned_provinces_with = {
        value = 15
        has_manufactory_trigger = yes
      }
    }
    effect = {
      add_country_modifier = {
        name = th_FLR_economic_support
        duration = 7300
      }
    }
  }
  flr_industrialize_empire = {
    icon = industrialized_rhineland
    required_missions = {
      flr_economic_support_army
    }
    position = 7
    provinces_to_highlight = {
      trade_goods = coal
    }
    trigger = {
      has_institution = industrialization
      if = {
        limit = {
          has_dlc = "Rule Britannia"
        }
        num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
          trade_goods = coal
          value = 5
        }
      }
      else = {
        num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
          value = 40
          has_manufactory_trigger = yes
        }
      }
    }
    effect = {
      add_country_modifier = {
        name = th_FLR_industrialize_empire
        duration = 7300
      }
    }
  }
  flr_control_italy = {
    icon = complete_the_risorgimento
    required_missions = {
      flr_imperial_crown_of_germany
    }
    position = 9
    provinces_to_highlight = {
      OR = {
        is_part_of_hre = no
        NOT = {
          country_or_non_sovereign_subject_holds = ROOT
        }
      }
      region = italy_region
    }
    trigger = {
      OR = {
        num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
          value = 40
          region = italy_region
        }
        AND = {
          is_emperor = yes
          calc_true_if = {
            all_province = {
              is_part_of_hre = yes
              region = italy_region
            }
            amount = 40
          }
        }
      }
    }
    effect = {
      add_country_modifier = {
        name = th_FLR_control_italy
        duration = 7300
      }
    }
  }
}