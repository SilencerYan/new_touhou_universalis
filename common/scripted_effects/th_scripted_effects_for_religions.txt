th_deity_war_penalty = {
  custom_tooltip = th_deity_war_penalty_tt
  hidden_effect = {
    set_country_flag = th_deity_penalty_active
  }
  if = {
    limit = {
      th_hkr_deity_at_war_with_hakurei = yes
    }
    add_country_modifier = {
      name = th_penalty_Hakurei_God_modifier
      desc = th_penalty_modifier_desc
      duration = -1
    }
  }
  else_if = {
    limit = {
      th_hkr_deity_at_war_with_yukari = yes
    }
    add_country_modifier = {
      name = th_penalty_Yukari_modifier
      desc = th_penalty_modifier_desc
      duration = -1
    }
  }
  else_if = {
    limit = {
      th_hkr_deity_at_war_with_hecatia = yes
    }
    add_country_modifier = {
      name = th_penalty_Hecatia_modifier
      desc = th_penalty_modifier_desc
      duration = -1
    }
  }
  else_if = {
    limit = {
      th_hkr_deity_at_war_with_okina = yes
    }
    add_country_modifier = {
      name = th_penalty_Okina_modifier
      desc = th_penalty_modifier_desc
      duration = -1
    }
  }
  else_if = {
    limit = {
      th_hkr_deity_at_war_with_larva = yes
    }
    add_country_modifier = {
      name = th_penalty_Larva_modifier
      desc = th_penalty_modifier_desc
      duration = -1
    }
  }
  else_if = {
    limit = {
      th_hkr_deity_at_war_with_aki = yes
    }
    add_country_modifier = {
      name = th_penalty_Aki_Sisters_modifier
      desc = th_penalty_modifier_desc
      duration = -1
    }
  }
  else_if = {
    limit = {
      th_hkr_deity_at_war_with_junko = yes
    }
    add_country_modifier = {
      name = th_penalty_Junko_modifier
      desc = th_penalty_modifier_desc
      duration = -1
    }
  }
  else_if = {
    limit = {
      th_hkr_deity_at_war_with_kishin = yes
    }
    add_country_modifier = {
      name = th_penalty_Kishin_modifier
      desc = th_penalty_modifier_desc
      duration = -1
    }
  }
  else_if = {
    limit = {
      th_hkr_deity_at_war_with_shinki = yes
    }
    add_country_modifier = {
      name = th_penalty_Shinki_modifier
      desc = th_penalty_modifier_desc
      duration = -1
    }
  }
  else_if = {
    limit = {
      th_hkr_deity_at_war_with_keiki = yes
    }
    add_country_modifier = {
      name = th_penalty_Keiki_modifier
      desc = th_penalty_modifier_desc
      duration = -1
    }
  }
  else_if = {
    limit = {
      th_hkr_deity_at_war_with_hina = yes
    }
    add_country_modifier = {
      name = th_penalty_Hina_modifier
      desc = th_penalty_modifier_desc
      duration = -1
    }
  }
  else_if = {
    limit = {
      th_hkr_deity_at_war_with_kutaka = yes
    }
    add_country_modifier = {
      name = th_penalty_Kutaka_modifier
      desc = th_penalty_modifier_desc
      duration = -1
    }
  }
}
th_deity_clear_penalty = {
  clr_country_flag = th_deity_penalty_active
  remove_country_modifier = th_penalty_Hakurei_God_modifier
  remove_country_modifier = th_penalty_Yukari_modifier
  remove_country_modifier = th_penalty_Hecatia_modifier
  remove_country_modifier = th_penalty_Okina_modifier
  remove_country_modifier = th_penalty_Larva_modifier
  remove_country_modifier = th_penalty_Aki_Sisters_modifier
  remove_country_modifier = th_penalty_Junko_modifier
  remove_country_modifier = th_penalty_Kishin_modifier
  remove_country_modifier = th_penalty_Shinki_modifier
  remove_country_modifier = th_penalty_Keiki_modifier
  remove_country_modifier = th_penalty_Hina_modifier
  remove_country_modifier = th_penalty_Kutaka_modifier
}
th_deity_remove_all_modifiers = {
  custom_tooltip = th_deity_remove_all_modifiers.tt
  hidden_effect = {
    remove_country_modifier = th_deity_huge_festieval
    remove_country_modifier = th_deity_shrine_maiden_training
    remove_country_modifier = th_deity_yukari_spies
    remove_country_modifier = th_deity_yukaris_isekai_quartet
    remove_country_modifier = th_deity_hecatia_to_hell_with_rebels
    remove_country_modifier = th_deity_earth_aspect
    remove_country_modifier = th_deity_moon_aspect
    remove_country_modifier = th_deity_otherworld_aspect
    remove_country_modifier = th_deity_fort_backdoors
    remove_country_modifier = th_deity_door_to_a_new_world
    remove_country_modifier = th_deity_colonial_dancing
    remove_country_modifier = th_deity_blessed_crops
    remove_country_modifier = th_deity_fertility_blessing
    remove_country_modifier = th_deity_junkos_fury
    remove_country_modifier = th_deity_legacy_of_china
    remove_country_modifier = th_deity_powerword_poverty
    remove_country_modifier = th_deity_powerword_shipwreck
    remove_country_modifier = th_deity_lunarian_wall
    remove_country_modifier = th_deity_makaien_architecture
    remove_country_modifier = th_deity_makaien_toxics
    remove_country_modifier = th_deity_rested_spirits
    remove_country_modifier = th_deity_the_army_mayumi
    remove_country_modifier = th_deity_expanding_fortune
    remove_country_modifier = th_deity_fortunate_intentions
    remove_country_modifier = th_deity_fortune_to_the_warriors
    remove_country_modifier = th_deity_war_misfortune
    remove_country_modifier = th_deity_miracle_of_modernization
    remove_country_modifier = th_deity_more_shrine_maiden
    remove_country_modifier = th_deity_suwakos_connections
    remove_country_modifier = th_deity_creation_of_heaven
    remove_country_modifier = th_deity_kanakos_vassal_policy
    every_owned_province = {
      remove_province_modifier = th_deity_toxic_province
      remove_province_modifier = th_deity_youkai_extermination
      remove_province_modifier = th_deity_earthy_walls
      remove_province_modifier = th_deity_war_misfortune
    }
  }
}
th_ds_set_deity_buff_up = {
  if = {
    limit = {
      OR = {
        tag = HKR
        was_tag = HKR
        AND = {
          dynasty = "ZSKN"  # Hakurei
          OR = {
            AND = {
              has_reform = Gensokyan_divine_state
              ruler_has_personality = immortal_personality
            }
            NOT = {
              has_reform = Gensokyan_divine_state
            }
          }
        }
      }
    }
    set_country_flag = th_ds_improved_deity
    set_country_flag = th_ds_improved_deity_for_hakurei
  }
  else_if = {
    limit = {
      OR = {
        tag = MHG
        was_tag = MHG
        AND = {
          dynasty = "kQ‘N"  # Yakumo
          OR = {
            AND = {
              has_reform = Gensokyan_divine_state
              ruler_has_personality = immortal_personality
            }
            NOT = {
              has_reform = Gensokyan_divine_state
            }
          }
        }
      }
    }
    set_country_flag = th_ds_improved_deity
    set_country_flag = th_ds_improved_deity_for_yakumo
  }
  else_if = {
    limit = {
      OR = {
        tag = HEC
        was_tag = HEC
        AND = {
          dynasty = "Ébµx¯eÉbVy)R"  # Lapislazuli
          OR = {
            AND = {
              has_reform = Gensokyan_divine_state
              ruler_has_personality = immortal_personality
            }
            NOT = {
              has_reform = Gensokyan_divine_state
            }
          }
        }
      }
    }
    set_country_flag = th_ds_improved_deity
    set_country_flag = th_ds_improved_deity_for_hecatia
  }
  else_if = {
    limit = {
      OR = {
        tag = OKI
        was_tag = OKI
        AND = {
          dynasty = "idYW"  # Matara
          OR = {
            AND = {
              has_reform = Gensokyan_divine_state
              ruler_has_personality = immortal_personality
            }
            NOT = {
              has_reform = Gensokyan_divine_state
            }
          }
        }
      }
    }
    set_country_flag = th_ds_improved_deity
    set_country_flag = th_ds_improved_deity_for_okina
  }
  else_if = {
    limit = {
      OR = {
        tag = LRV
        was_tag = LRV
        AND = {
          dynasty = "ÉbSæt"  # Larva
          OR = {
            AND = {
              has_reform = Gensokyan_divine_state
              ruler_has_personality = immortal_personality
            }
            NOT = {
              has_reform = Gensokyan_divine_state
            }
          }
        }
      }
    }
    set_country_flag = th_ds_improved_deity
    set_country_flag = th_ds_improved_deity_for_larva
  }
  else_if = {
    limit = {
      OR = {
        tag = AKI
        was_tag = AKI
        AND = {
          dynasty = "Ëy"  # Aki
          OR = {
            AND = {
              has_reform = Gensokyan_divine_state
              ruler_has_personality = immortal_personality
            }
            NOT = {
              has_reform = Gensokyan_divine_state
            }
          }
        }
      }
    }
    set_country_flag = th_ds_improved_deity
    set_country_flag = th_ds_improved_deity_for_aki
  }
  else_if = {
    limit = {
      OR = {
        tag = JNK
        was_tag = JNK
        AND = {
          has_ruler = "¯uÐr"  # Junko
          dynasty = " "
          OR = {
            AND = {
              has_reform = Gensokyan_divine_state
              ruler_has_personality = immortal_personality
            }
            NOT = {
              has_reform = Gensokyan_divine_state
            }
          }
        }
      }
    }
    set_country_flag = th_ds_improved_deity
    set_country_flag = th_ds_improved_deity_for_junko
  }
  else_if = {
    limit = {
      OR = {
        tag = LCU
        was_tag = LCU
        AND = {
          dynasty = "z^y"  # Kishin
          OR = {
            AND = {
              has_reform = Gensokyan_divine_state
              ruler_has_personality = immortal_personality
            }
            NOT = {
              has_reform = Gensokyan_divine_state
            }
          }
        }
      }
    }
    set_country_flag = th_ds_improved_deity
    set_country_flag = th_ds_improved_deity_for_kishin
  }
  else_if = {
    limit = {
      OR = {
        tag = MKI
        was_tag = MKI
        AND = {
          dynasty = "T›Lu„v"  # of Makai
          OR = {
            AND = {
              has_reform = Gensokyan_divine_state
              ruler_has_personality = immortal_personality
            }
            NOT = {
              has_reform = Gensokyan_divine_state
            }
          }
        }
      }
    }
    set_country_flag = th_ds_improved_deity
    set_country_flag = th_ds_improved_deity_for_shinki
  }
  else_if = {
    limit = {
      OR = {
        tag = KEI
        was_tag = KEI
        AND = {
          dynasty = "ôW‰R^y"  # Haniyasushin
          OR = {
            AND = {
              has_reform = Gensokyan_divine_state
              ruler_has_personality = immortal_personality
            }
            NOT = {
              has_reform = Gensokyan_divine_state
            }
          }
        }
      }
    }
    set_country_flag = th_ds_improved_deity
    set_country_flag = th_ds_improved_deity_for_keiki
  }
  else_if = {
    limit = {
      OR = {
        tag = YOF
        was_tag = YOF
        AND = {
          dynasty = ".•qS"  # Kagiyama
          OR = {
            AND = {
              has_reform = Gensokyan_divine_state
              ruler_has_personality = immortal_personality
            }
            NOT = {
              has_reform = Gensokyan_divine_state
            }
          }
        }
      }
    }
    set_country_flag = th_ds_improved_deity
    set_country_flag = th_ds_improved_deity_for_hina
  }
  else_if = {
    limit = {
      OR = {
        tag = GGS
        was_tag = GGS
        AND = {
          dynasty = "­^!n"  # Niwatari
          OR = {
            AND = {
              has_reform = Gensokyan_divine_state
              ruler_has_personality = immortal_personality
            }
            NOT = {
              has_reform = Gensokyan_divine_state
            }
          }
        }
      }
    }
    set_country_flag = th_ds_improved_deity
    set_country_flag = th_ds_improved_deity_for_kutaka
  }
  else_if = {
    limit = {
      OR = {
        tag = MRY
        was_tag = MRY
        AND = {
          dynasty = "NÎ˜7Œ"  # Kochiya
          OR = {
            AND = {
              has_reform = Gensokyan_divine_state
              ruler_has_personality = immortal_personality
            }
            NOT = {
              has_reform = Gensokyan_divine_state
            }
          }
        }
      }
    }
    set_country_flag = th_ds_improved_deity
    set_country_flag = th_ds_improved_deity_for_kochiya
  }
  else_if = {
    limit = {
      OR = {
        tag = MRY
        was_tag = MRY
        AND = {
          dynasty = ")mâw"  # Moriya
          OR = {
            AND = {
              has_reform = Gensokyan_divine_state
              ruler_has_personality = immortal_personality
            }
            NOT = {
              has_reform = Gensokyan_divine_state
            }
          }
        }
      }
    }
    set_country_flag = th_ds_improved_deity
    set_country_flag = th_ds_improved_deity_for_suwako
  }
  else_if = {
    limit = {
      OR = {
        tag = MRY
        was_tag = MRY
        AND = {
          dynasty = "kQBW"  # Kanako
          OR = {
            AND = {
              has_reform = Gensokyan_divine_state
              ruler_has_personality = immortal_personality
            }
            NOT = {
              has_reform = Gensokyan_divine_state
            }
          }
        }
      }
    }
    set_country_flag = th_ds_improved_deity
    set_country_flag = th_ds_improved_deity_for_kanako
  }
  else = {
    set_country_flag = th_ds_reduced_new_deity_cooldown
  }
}
th_ds_clear_improved_deity_flags = {
  clr_country_flag = th_ds_improved_deity
  clr_country_flag = th_ds_reduced_new_deity_cooldown
  clr_country_flag = th_ds_improved_deity_for_hakurei
  clr_country_flag = th_ds_improved_deity_for_yakumo
  clr_country_flag = th_ds_improved_deity_for_hecatia
  clr_country_flag = th_ds_improved_deity_for_okina
  clr_country_flag = th_ds_improved_deity_for_aki
  clr_country_flag = th_ds_improved_deity_for_shinki
  clr_country_flag = th_ds_improved_deity_for_kishin
  clr_country_flag = th_ds_improved_deity_for_hina
  clr_country_flag = th_ds_improved_deity_for_kutaka
  clr_country_flag = th_ds_improved_deity_for_larva
  clr_country_flag = th_ds_improved_deity_for_keiki
  clr_country_flag = th_ds_improved_deity_for_junko
  clr_country_flag = th_ds_improved_deity_for_suwako
  clr_country_flag = th_ds_improved_deity_for_kochiya
  clr_country_flag = th_ds_improved_deity_for_kanako
}
th_ds_excuse_religion_swapping = {
  if = {
    limit = {
      has_government_attribute = th_divine_legitimacy_mechanic
    }
    custom_tooltip = th_ds_excuse_religion_swapping_tt
    hidden_effect = {
      set_country_flag = th_is_excused_to_change_religion
    }
  }
}
th_clear_religious_scholar_modifiers_effect = {
  remove_country_modifier = th_hakureishinto_scholar_modifier
  remove_country_modifier = th_yakumo_scholar_modifier
  remove_country_modifier = th_hecatia_scholar_modifier
  remove_country_modifier = th_okina_scholar_modifier
  remove_country_modifier = th_aki_scholar_modifier
  remove_country_modifier = th_junko_scholar_modifier
  remove_country_modifier = th_kishin_scholar_modifier
  remove_country_modifier = th_shinki_scholar_modifier
  remove_country_modifier = th_keiki_scholar_modifier
  remove_country_modifier = th_hina_scholar_modifier
  remove_country_modifier = th_kutaka_scholar_modifier
  remove_country_modifier = th_kochiya_scholar_modifier
  remove_country_modifier = th_moriya_scholar_modifier
  remove_country_modifier = th_kanako_scholar_modifier
}
th_clear_buddhist_teaching_modifiers_effect = {
  remove_country_modifier = th_byakuren_teachings_modifier
  remove_country_modifier = th_myouren_teachings_modifier
  remove_country_modifier = th_soutou_teachings_modifier
  remove_country_modifier = th_rinzai_teachings_modifier
  remove_country_modifier = th_obaku_teachings_modifier
}
th_set_touhou_school = {
  if = {
    limit = {
      OR = {
        tag = MKI
        was_tag = MKI
      }
      has_religious_school = no
    }
    set_religious_school = {
      group = "Touhou"
      school = shinki_school
    }
  }
  else_if = {
    limit = {
      OR = {
        tag = LCU
        was_tag = LCU
        tag = EIT
        was_tag = EIT
      }
      has_religious_school = no
    }
    set_religious_school = {
      group = "Touhou"
      school = kishin_school
    }
  }
  else_if = {
    limit = {
      OR = {
        tag = HIG
        was_tag = HIG
        tag = HEC
        was_tag = HEC
      }
      has_religious_school = no
    }
    set_religious_school = {
      group = "Touhou"
      school = hecatia_school
    }
  }
  else_if = {
    limit = {
      OR = {
        tag = JNK
        was_tag = JNK
      }
      has_religious_school = no
    }
    set_religious_school = {
      group = "Touhou"
      school = junko_school
    }
  }
  else_if = {
    limit = {
      OR = {
        tag = OKI
        was_tag = OKI
      }
      has_religious_school = no
    }
    set_religious_school = {
      group = "Touhou"
      school = okina_school
    }
  }
  else_if = {
    limit = {
      OR = {
        tag = AKI
        was_tag = AKI
      }
      has_religious_school = no
    }
    set_religious_school = {
      group = "Touhou"
      school = aki_school
    }
  }
  else_if = {
    limit = {
      OR = {
        tag = YOF
        was_tag = YOF
      }
      has_religious_school = no
    }
    set_religious_school = {
      group = "Touhou"
      school = hina_school
    }
  }
  else_if = {
    limit = {
      OR = {
        tag = MHG
        was_tag = MHG
      }
      has_religious_school = no
    }
    set_religious_school = {
      group = "Touhou"
      school = yukari_school
    }
  }
  else_if = {
    limit = {
      OR = {
        tag = HKR
        was_tag = HKR
      }
      has_religious_school = no
    }
    set_religious_school = {
      group = "Touhou"
      school = hakurei_school
    }
  }
  else_if = {
    limit = {
      OR = {
        tag = KEI
        was_tag = KEI
      }
      has_religious_school = no
    }
    set_religious_school = {
      group = "Touhou"
      school = keiki_school
    }
  }
  else_if = {
    limit = {
      OR = {
        tag = GGS
        was_tag = GGS
      }
      has_religious_school = no
    }
    set_religious_school = {
      group = "Touhou"
      school = kutaka_school
    }
  }
}
th_buddhistic_school_of_thought = {
  set_religious_school = {
    group = "Touhou"
    school = $school$
  }
  custom_tooltip = th_buddhist_pick_school_of_thought_benefits_tt
  custom_tooltip = $school$_benefits_tt
  custom_tooltip = th_buddhist_pick_school_of_thought_drawbacks_tt
  custom_tooltip = $school$_drawbacks_tt
}
th_mry_holy_site_activation_effect = {
  set_global_flag = $holy_site_flag$
  every_country = {
    limit = {
      religion = th_moriyashinto
    }
    country_event = {
      id = $activation_event$
    }
  }
}
th_mry_holy_site_deactivation_effect = {
  clr_global_flag = $holy_site_flag$
  every_country = {
    limit = {
      religion = th_moriyashinto
    }
    country_event = {
      id = $deactivation_event$
    }
  }
}
th_mry_shinto_remove_sanae_buffs = {
  hidden_effect = {
    remove_country_modifier = th_mry_shinto_hakureis_power
    remove_country_modifier = th_mry_shinto_keikis_idols
    remove_country_modifier = th_mry_shinto_kishin_lunar_naval
  }
}
th_mry_shinto_remove_suwako_buffs = {
  hidden_effect = {
    remove_country_modifier = th_mry_shinto_sukunas_envoys
    remove_country_modifier = th_mry_shinto_hinas_misfortune
    remove_country_modifier = th_mry_shinto_hecatias_hell_workers
  }
}
th_mry_shinto_remove_kanako_buffs = {
  hidden_effect = {
    remove_country_modifier = th_mry_shinto_junkos_fury
    remove_country_modifier = th_mry_shinto_shinkis_merchants
    remove_country_modifier = th_mry_shinto_satoris_influence
  }
}
th_mry_shinto_remove_boni = {
  hidden_effect = {
    th_mry_shinto_remove_sanae_buffs = yes
    th_mry_shinto_remove_suwako_buffs = yes
    th_mry_shinto_remove_kanako_buffs = yes
  }
}
th_buddhism_clear_meditation = {
  custom_tooltip = th_bdh_longer_cancel_meditation
  hidden_effect = {
    set_country_flag = th_buddhism_meditation_cd
    remove_country_modifier = th_buddhism_meditating
    clr_ruler_flag = th_buddhism_ruler_is_meditating
    clr_ruler_flag = th_buddhism_meditation_available
  }
}
th_buddhism_prepare_add_harmonized_religion_effect = {
  hidden_effect = {
    trigger_switch = {
      on_trigger = religion
      th_hakureishinto = {
        set_country_flag = th_was_th_hakureishinto
      }
      th_moriyashinto = {
        set_country_flag = th_was_th_moriyashinto
      }
      th_taoist = {
        set_country_flag = th_was_th_taoist
      }
      th_oldhakurei = {
        set_country_flag = th_was_th_oldhakurei
      }
      th_shinkism = {
        set_country_flag = th_was_th_shinkism
      }
      th_scientistic = {
        set_country_flag = th_was_th_scientistic
      }
      th_lunarian_religion = {
        set_country_flag = th_was_th_lunarian_religion
      }
      catholic = {
        set_country_flag = th_was_catholic
      }
      anglican = {
        set_country_flag = th_was_anglican
      }
      hussite = {
        set_country_flag = th_was_hussite
      }
      protestant = {
        set_country_flag = th_was_protestant
      }
      reformed = {
        set_country_flag = th_was_reformed
      }
      orthodox = {
        set_country_flag = th_was_orthodox
      }
      coptic = {
        set_country_flag = th_was_coptic
      }
      sunni = {
        set_country_flag = th_was_sunni
      }
      shiite = {
        set_country_flag = th_was_shiite
      }
      ibadi = {
        set_country_flag = th_was_ibadi
      }
      buddhism = {
        set_country_flag = th_was_buddhism
      }
      vajrayana = {
        set_country_flag = th_was_vajrayana
      }
      mahayana = {
        set_country_flag = th_was_mahayana
      }
      confucianism = {
        set_country_flag = th_was_confucianism
      }
      shinto = {
        set_country_flag = th_was_shinto
      }
      hinduism = {
        set_country_flag = th_was_hinduism
      }
      sikhism = {
        set_country_flag = th_was_sikhism
      }
      animism = {
        set_country_flag = th_was_animism
      }
      shamanism = {
        set_country_flag = th_was_shamanism
      }
      totemism = {
        set_country_flag = th_was_totemism
      }
      inti = {
        set_country_flag = th_was_inti
      }
      nahuatl = {
        set_country_flag = th_was_nahuatl
      }
      mesoamerican_religion = {
        set_country_flag = th_was_mesoamerican_religion
      }
      norse_pagan_reformed = {
        set_country_flag = th_was_norse_pagan_reformed
      }
      tengri_pagan_reformed = {
        set_country_flag = th_was_tengri_pagan_reformed
      }
      dreamtime = {
        set_country_flag = th_was_dreamtime
      }
      jewish = {
        set_country_flag = th_was_jewish
      }
      zoroastrian = {
        set_country_flag = th_was_zoroastrian
      }
    }
  }
}
th_buddhism_harmonize_previous_religion = {
  trigger_switch = {
    on_trigger = has_country_flag
    th_was_th_hakureishinto = {
      add_harmonized_religion = th_hakureishinto
      hidden_effect = {
        clr_country_flag = th_was_th_hakureishinto
      }
    }
    th_was_th_moriyashinto = {
      add_harmonized_religion = th_moriyashinto
      hidden_effect = {
        clr_country_flag = th_was_th_moriyashinto
      }
    }
    th_was_th_taoist = {
      add_harmonized_religion = th_taoist
      hidden_effect = {
        clr_country_flag = th_was_th_taoist
      }
    }
    th_was_th_oldhakurei = {
      add_harmonized_religion = th_oldhakurei
      hidden_effect = {
        clr_country_flag = th_was_th_oldhakurei
      }
    }
    th_was_th_shinkism = {
      add_harmonized_religion = th_shinkism
      hidden_effect = {
        clr_country_flag = th_was_th_shinkism
      }
    }
    th_was_th_scientistic = {
      add_harmonized_religion = th_scientistic
      hidden_effect = {
        clr_country_flag = th_was_th_scientistic
      }
    }
    th_was_th_lunarian_religion = {
      add_harmonized_religion = th_lunarian_religion
      hidden_effect = {
        clr_country_flag = th_was_th_lunarian_religion
      }
    }
    th_was_catholic = {
      add_harmonized_religion = catholic
      hidden_effect = {
        clr_country_flag = th_was_catholic
      }
    }
    th_was_anglican = {
      add_harmonized_religion = anglican
      hidden_effect = {
        clr_country_flag = th_was_anglican
      }
    }
    th_was_hussite = {
      add_harmonized_religion = hussite
      hidden_effect = {
        clr_country_flag = th_was_hussite
      }
    }
    th_was_protestant = {
      add_harmonized_religion = protestant
      hidden_effect = {
        clr_country_flag = th_was_protestant
      }
    }
    th_was_reformed = {
      add_harmonized_religion = reformed
      hidden_effect = {
        clr_country_flag = th_was_reformed
      }
    }
    th_was_orthodox = {
      add_harmonized_religion = orthodox
      hidden_effect = {
        clr_country_flag = th_was_orthodox
      }
    }
    th_was_coptic = {
      add_harmonized_religion = coptic
      hidden_effect = {
        clr_country_flag = th_was_coptic
      }
    }
    th_was_sunni = {
      add_harmonized_religion = sunni
      hidden_effect = {
        clr_country_flag = th_was_sunni
      }
    }
    th_was_shiite = {
      add_harmonized_religion = shiite
      hidden_effect = {
        clr_country_flag = th_was_shiite
      }
    }
    th_was_ibadi = {
      add_harmonized_religion = ibadi
      hidden_effect = {
        clr_country_flag = th_was_ibadi
      }
    }
    th_was_buddhism = {
      add_harmonized_religion = buddhism
      hidden_effect = {
        clr_country_flag = th_was_buddhism
      }
    }
    th_was_vajrayana = {
      add_harmonized_religion = vajrayana
      hidden_effect = {
        clr_country_flag = th_was_vajrayana
      }
    }
    th_was_mahayana = {
      add_harmonized_religion = mahayana
      hidden_effect = {
        clr_country_flag = th_was_mahayana
      }
    }
    th_was_confucianism = {
      add_harmonized_religion = confucianism
      hidden_effect = {
        clr_country_flag = th_was_confucianism
      }
    }
    th_was_shinto = {
      add_harmonized_religion = shinto
      hidden_effect = {
        clr_country_flag = th_was_shinto
      }
    }
    th_was_hinduism = {
      add_harmonized_religion = hinduism
      hidden_effect = {
        clr_country_flag = th_was_hinduism
      }
    }
    th_was_sikhism = {
      add_harmonized_religion = sikhism
      hidden_effect = {
        clr_country_flag = th_was_sikhism
      }
    }
    th_was_animism = {
      add_harmonized_religion = animism
      hidden_effect = {
        clr_country_flag = th_was_animism
      }
    }
    th_was_shamanism = {
      add_harmonized_religion = shamanism
      hidden_effect = {
        clr_country_flag = th_was_shamanism
      }
    }
    th_was_totemism = {
      add_harmonized_religion = totemism
      hidden_effect = {
        clr_country_flag = th_was_totemism
      }
    }
    th_was_inti = {
      add_harmonized_religion = inti
      hidden_effect = {
        clr_country_flag = th_was_inti
      }
    }
    th_was_nahuatl = {
      add_harmonized_religion = nahuatl
      hidden_effect = {
        clr_country_flag = th_was_nahuatl
      }
    }
    th_was_mesoamerican_religion = {
      add_harmonized_religion = mesoamerican_religion
      hidden_effect = {
        clr_country_flag = th_was_mesoamerican_religion
      }
    }
    th_was_norse_pagan_reformed = {
      add_harmonized_religion = norse_pagan_reformed
      hidden_effect = {
        clr_country_flag = th_was_norse_pagan_reformed
      }
    }
    th_was_tengri_pagan_reformed = {
      add_harmonized_religion = tengri_pagan_reformed
      hidden_effect = {
        clr_country_flag = th_was_tengri_pagan_reformed
      }
    }
    th_was_dreamtime = {
      add_harmonized_religion = dreamtime
      hidden_effect = {
        clr_country_flag = th_was_dreamtime
      }
    }
    th_was_jewish = {
      add_harmonized_religion = jewish
      hidden_effect = {
        clr_country_flag = th_was_jewish
      }
    }
    th_was_zoroastrian = {
      add_harmonized_religion = zoroastrian
      hidden_effect = {
        clr_country_flag = th_was_zoroastrian
      }
    }
  }
}
th_buddhism_clean_up_flags = {
  hidden_effect = {
    clr_country_flag = th_was_th_hakureishinto
    clr_country_flag = th_was_th_moriyashinto
    clr_country_flag = th_was_th_taoist
    clr_country_flag = th_was_th_oldhakurei
    clr_country_flag = th_was_th_shinkism
    clr_country_flag = th_was_th_scientistic
    clr_country_flag = th_was_th_lunarian_religion
    clr_country_flag = th_was_christian
    clr_country_flag = th_was_muslim
    clr_country_flag = th_was_eastern
    clr_country_flag = th_was_dharmic
    clr_country_flag = th_was_pagan
    clr_country_flag = th_was_jewish_group
    clr_country_flag = th_was_zoroastrian_group
    clr_country_flag = th_was_catholic
    clr_country_flag = th_was_anglican
    clr_country_flag = th_was_hussite
    clr_country_flag = th_was_protestant
    clr_country_flag = th_was_reformed
    clr_country_flag = th_was_orthodox
    clr_country_flag = th_was_coptic
    clr_country_flag = th_was_sunni
    clr_country_flag = th_was_shiite
    clr_country_flag = th_was_ibadi
    clr_country_flag = th_was_buddhism
    clr_country_flag = th_was_vajrayana
    clr_country_flag = th_was_mahayana
    clr_country_flag = th_was_confucianism
    clr_country_flag = th_was_shinto
    clr_country_flag = th_was_hinduism
    clr_country_flag = th_was_sikhism
    clr_country_flag = th_was_animism
    clr_country_flag = th_was_shamanism
    clr_country_flag = th_was_totemism
    clr_country_flag = th_was_inti
    clr_country_flag = th_was_nahuatl
    clr_country_flag = th_was_mesoamerican_religion
    clr_country_flag = th_was_norse_pagan_reformed
    clr_country_flag = th_was_tengri_pagan_reformed
    clr_country_flag = th_was_dreamtime
    clr_country_flag = th_was_jewish
    clr_country_flag = th_was_zoroastrian
  }
}
th_increase_estate_influence_due_soutou = {
  if = {
    limit = {
      religious_school = {
        group = "Touhou"
        school = soutou_teachings
      }
    }
    add_estate_influence_modifier = {
      estate = $estate$
      desc = TH_HIRED_ADVISOR_EFFECT
      duration = 5475
      influence = 15
      short = yes
    }
  }
}
th_taoism_remove_all_five_ways = {
  remove_country_modifier = th_taoism_wood_cycle
  remove_country_modifier = th_taoism_fire_cycle
  remove_country_modifier = th_taoism_earth_cycle
  remove_country_modifier = th_taoism_metal_cycle
  remove_country_modifier = th_taoism_water_cycle
  clr_country_flag = th_taoism_had_wood
  clr_country_flag = th_taoism_had_fire
  clr_country_flag = th_taoism_had_earth
  clr_country_flag = th_taoism_had_metal
  clr_country_flag = th_taoism_had_water
  clr_country_flag = th_taoism_prev_cycle_water
  clr_country_flag = th_taoism_prev_cycle_wood
  clr_country_flag = th_taoism_prev_cycle_fire
  clr_country_flag = th_taoism_prev_cycle_earth
  clr_country_flag = th_taoism_prev_cycle_metal
}
th_taoism_set_cycle_to_wood = {
  set_country_flag = th_taoism_had_wood
  set_country_flag = th_taoism_prev_cycle_water
  add_country_modifier = {
    name = th_taoism_wood_cycle
    duration = -1
  }
}
th_taoism_set_cycle_to_fire = {
  set_country_flag = th_taoism_had_fire
  set_country_flag = th_taoism_prev_cycle_wood
  add_country_modifier = {
    name = th_taoism_fire_cycle
    duration = -1
  }
}
th_taoism_set_cycle_to_earth = {
  set_country_flag = th_taoism_had_earth
  set_country_flag = th_taoism_prev_cycle_fire
  add_country_modifier = {
    name = th_taoism_earth_cycle
    duration = -1
  }
}
th_taoism_set_cycle_to_metal = {
  set_country_flag = th_taoism_had_metal
  set_country_flag = th_taoism_prev_cycle_earth
  add_country_modifier = {
    name = th_taoism_metal_cycle
    duration = -1
  }
}
th_taoism_set_cycle_to_water = {
  set_country_flag = th_taoism_had_water
  set_country_flag = th_taoism_prev_cycle_metal
  add_country_modifier = {
    name = th_taoism_water_cycle
    duration = -1
  }
}
th_taoism_set_cycle = {
  th_taoism_remove_all_five_ways = yes
  th_taoism_set_cycle_to_$type$ = yes
}
th_taoism_normal_cycle = {
  if = {
    limit = {
      th_current_wuxing_cycle = {
        type = wood
      }
    }
    th_taoism_set_cycle = {
      type = fire
    }
  }
  else_if = {
    limit = {
      th_current_wuxing_cycle = {
        type = fire
      }
    }
    th_taoism_set_cycle = {
      type = earth
    }
  }
  else_if = {
    limit = {
      th_current_wuxing_cycle = {
        type = earth
      }
    }
    th_taoism_set_cycle = {
      type = metal
    }
  }
  else_if = {
    limit = {
      th_current_wuxing_cycle = {
        type = metal
      }
    }
    th_taoism_set_cycle = {
      type = water
    }
  }
  else_if = {
    limit = {
      th_current_wuxing_cycle = {
        type = water
      }
    }
    th_taoism_set_cycle = {
      type = wood
    }
  }
}
th_taoism_revert_cycle = {
  if = {
    limit = {
      th_current_wuxing_cycle = {
        type = wood
      }
    }
    th_taoism_set_cycle = {
      type = water
    }
  }
  else_if = {
    limit = {
      th_current_wuxing_cycle = {
        type = fire
      }
    }
    th_taoism_set_cycle = {
      type = wood
    }
  }
  else_if = {
    limit = {
      th_current_wuxing_cycle = {
        type = earth
      }
    }
    th_taoism_set_cycle = {
      type = fire
    }
  }
  else_if = {
    limit = {
      th_current_wuxing_cycle = {
        type = metal
      }
    }
    th_taoism_set_cycle = {
      type = earth
    }
  }
  else_if = {
    limit = {
      th_current_wuxing_cycle = {
        type = water
      }
    }
    th_taoism_set_cycle = {
      type = metal
    }
  }
}
th_taoism_control_cycle = {
  if = {
    limit = {
      th_current_wuxing_cycle = {
        type = wood
      }
    }
    th_taoism_set_cycle = {
      type = earth
    }
  }
  else_if = {
    limit = {
      th_current_wuxing_cycle = {
        type = fire
      }
    }
    th_taoism_set_cycle = {
      type = metal
    }
  }
  else_if = {
    limit = {
      th_current_wuxing_cycle = {
        type = earth
      }
    }
    th_taoism_set_cycle = {
      type = water
    }
  }
  else_if = {
    limit = {
      th_current_wuxing_cycle = {
        type = metal
      }
    }
    th_taoism_set_cycle = {
      type = wood
    }
  }
  else_if = {
    limit = {
      th_current_wuxing_cycle = {
        type = water
      }
    }
    th_taoism_set_cycle = {
      type = fire
    }
  }
}
th_taoism_destroy_cycle = {
  if = {
    limit = {
      th_current_wuxing_cycle = {
        type = wood
      }
    }
    th_taoism_set_cycle = {
      type = metal
    }
  }
  else_if = {
    limit = {
      th_current_wuxing_cycle = {
        type = fire
      }
    }
    th_taoism_set_cycle = {
      type = water
    }
  }
  else_if = {
    limit = {
      th_current_wuxing_cycle = {
        type = earth
      }
    }
    th_taoism_set_cycle = {
      type = wood
    }
  }
  else_if = {
    limit = {
      th_current_wuxing_cycle = {
        type = metal
      }
    }
    th_taoism_set_cycle = {
      type = fire
    }
  }
  else_if = {
    limit = {
      th_current_wuxing_cycle = {
        type = water
      }
    }
    th_taoism_set_cycle = {
      type = earth
    }
  }
}
th_taoism_clear_feng_shui = {
  set_variable = {
    which = th_num_of_eligible_cities
    value = 0
  }
  every_owned_province = {
    limit = {
      OR = {
        has_province_modifier = th_bad_feng_shui
        has_province_modifier = th_good_feng_shui
      }
    }
    remove_province_modifier = th_bad_feng_shui
    remove_province_modifier = th_good_feng_shui
  }
}
th_taoism_set_up_provinces = {
  th_taoism_clear_feng_shui = yes
  every_owned_province = {
    limit = {
      religion = root
      is_state = yes
    }
    root = {
      change_variable = {
        which = th_num_of_eligible_cities
        value = 1
      }
    }
  }
  if = {
    limit = {
      has_government_attribute = capital_always_gains_good_feng_shui
    }
    capital_scope = {
      add_province_modifier = {
        name = th_good_feng_shui
        duration = 4380
      }
    }
  }
  export_to_variable = {
    which = th_max_amount_of_cities
    value = modifier:th_max_feng_shui_prov
  }
  export_to_variable = {
    which = th_feng_shui_to_prov_ratio
    value = modifier:th_feng_shui_to_prov_ratio
  }
  multiply_variable = {
    which = th_num_of_eligible_cities
    which = th_feng_shui_to_prov_ratio
  }
  if = {
    limit = {
      check_variable = {
        which = th_num_of_eligible_cities
        which = th_max_amount_of_cities
      }
    }
    set_variable = {
      which = th_num_of_eligible_cities
      which = th_max_amount_of_cities
    }
  }
  while = {
    limit = {
      check_variable = {
        which = th_num_of_eligible_cities
        value = 1
      }
    }
    subtract_variable = {
      which = th_num_of_eligible_cities
      value = 1
    }
    random_owned_province = {
      limit = {
        religion = root
        is_state = yes
        NOT = {
          has_province_modifier = th_bad_feng_shui
        }
        NOT = {
          has_province_modifier = th_good_feng_shui
        }
        NOT = {
          has_province_flag = th_feng_shui_flag
        }
      }
      set_province_flag = th_feng_shui_flag
    }
  }
  every_owned_province = {
    limit = {
      has_province_flag = th_feng_shui_flag
    }
    province_event = {
      id = th_taoism_feng_shui_events.3
    }
    clr_province_flag = th_feng_shui_flag
  }
}
th_selected_rune = {
  hidden_effect = {
    if = {
      limit = {
        NOT = {
          has_country_flag = th_selected_rune_of_$type$
        }
      }
      set_country_flag = th_selected_rune_of_$type$
      if = {
        limit = {
          NOT = {
            check_variable = {
              which = th_occult_rune_cost
              value = 3
            }
          }
        }
        change_variable = {
          which = th_occult_rune_cost
          value = 1
        }
      }
    }
  }
}
th_remove_all_occult_runes = {
  clr_country_flag = th_selected_rune_of_adm
  clr_country_flag = th_selected_rune_of_dip
  clr_country_flag = th_selected_rune_of_mil
  remove_church_aspect = th_occult_esper_wisdom_aspect
  remove_church_aspect = th_occult_telekinetic_construction_rune_aspect
  remove_church_aspect = th_occult_appeasing_of_mind_rune_aspect
  remove_church_aspect = th_occult_occult_curiosity_rune_aspect
  remove_church_aspect = th_occult_ritualistic_fees_rune_aspect
  remove_church_aspect = th_occult_supernatural_conviction_rune_aspect
  remove_church_aspect = th_occult_esper_knowledge_rune_aspect
  remove_church_aspect = th_occult_soothing_minds_rune_aspect
  remove_church_aspect = th_occult_mind_trick_rune_aspect
  remove_church_aspect = th_occult_telepathy_rune_aspect
  remove_church_aspect = th_occult_psionic_connection_rune_aspect
  remove_church_aspect = th_occult_mind_control_rune_aspect
  remove_church_aspect = th_occult_esper_resilience_rune_aspect
  remove_church_aspect = th_occult_kryokinesis_ice_block_rune_aspect
  remove_church_aspect = th_occult_hydrokinesis_tide_storm_rune_aspect
  remove_church_aspect = th_occult_pyrokinesis_explosive_sign_rune_aspect
  remove_church_aspect = th_occult_neurokinesis_motivation_rune_aspect
  remove_church_aspect = th_occult_psychokinesis_doppleganger_rune_aspect
}
th_unleash_rune_effect_adm = {
  if = {
    limit = {
      has_church_aspect = th_occult_esper_wisdom_aspect
    }
    custom_tooltip = th_occult_no_adm_penalty_tt
    add_church_power = 25
    if = {
      limit = {
        has_estate = estate_church
      }
      add_estate_loyalty = {
        estate = estate_church
        loyalty = 5
      }
    }
    if = {
      limit = {
        has_estate = estate_brahmins
      }
      add_estate_loyalty = {
        estate = estate_brahmins
        loyalty = 5
      }
    }
  }
  if = {
    limit = {
      has_church_aspect = th_occult_telekinetic_construction_rune_aspect
    }
    capital_scope = {
      add_base_tax = 1
      add_base_production = 1
      add_base_manpower = 1
    }
    add_country_modifier = {
      name = th_occult_telekinetic_construction_rune_aspect_mod
      duration = 1825
    }
  }
  if = {
    limit = {
      has_church_aspect = th_occult_appeasing_of_mind_rune_aspect
    }
    add_stability = 1
  }
  if = {
    limit = {
      has_church_aspect = th_occult_occult_curiosity_rune_aspect
    }
    add_adm_power = 25
    custom_tooltip = th_occult_all_colonies_buff_tt
    tooltip = {
      add_country_modifier = {
        name = th_occult_colony_buff
        duration = 1825
      }
    }
    hidden_effect = {
      every_subject_country = {
        limit = {
          OR = {
            is_subject_of_type = colony
            is_subject_of_type = crown_colony
            is_subject_of_type = self_governing_colony
            is_subject_of_type = private_enterprise
          }
        }
        add_country_modifier = {
          name = th_occult_colony_buff
          duration = 1825
        }
      }
    }
  }
  if = {
    limit = {
      has_church_aspect = th_occult_ritualistic_fees_rune_aspect
    }
    if = {
      limit = {
        NOT = {
          monthly_income = 416
        }
      }
      add_years_of_income = 0.1
    }
    else = {
      add_treasury = 500
    }
    custom_tooltip = th_occult_caps_at_500_tt
  }
  if = {
    limit = {
      has_church_aspect = th_occult_supernatural_conviction_rune_aspect
    }
    add_country_modifier = {
      name = th_occult_missionary_buff
      duration = 1825
    }
  }
}
th_unleash_rune_effect_dip = {
  if = {
    limit = {
      has_church_aspect = th_occult_esper_knowledge_rune_aspect
    }
    custom_tooltip = th_occult_no_dip_penalty_tt
    add_church_power = 25
    if = {
      limit = {
        has_estate = estate_burghers
      }
      add_estate_loyalty = {
        estate = estate_burghers
        loyalty = 5
      }
    }
    if = {
      limit = {
        has_estate = estate_jains
      }
      add_estate_loyalty = {
        estate = estate_jains
        loyalty = 5
      }
    }
    if = {
      limit = {
        has_estate = estate_vaisyas
      }
      add_estate_loyalty = {
        estate = estate_vaisyas
        loyalty = 5
      }
    }
    if = {
      limit = {
        has_estate = estate_crow_tengu
      }
      add_estate_loyalty = {
        estate = estate_crow_tengu
        loyalty = 5
      }
    }
  }
  if = {
    limit = {
      has_church_aspect = th_occult_soothing_minds_rune_aspect
    }
    custom_tooltip = th_occult_opinion_buff_to_every_country_tt
    hidden_effect = {
      every_known_country = {
        add_opinion = {
          who = ROOT
          modifier = th_occult_soothed_mind
        }
      }
    }
  }
  if = {
    limit = {
      has_church_aspect = th_occult_mind_trick_rune_aspect
    }
    custom_tooltip = th_occult_gain_claims_tt
    hidden_effect = {
      every_neighbor_province = {
        limit = {
          owner = {
            exists = yes
            NOT = {
              defensive_pact_with = ROOT
            }
            NOT = {
              is_subject_of = ROOT
            }
            NOT = {
              religion = ROOT
            }
          }
          NOT = {
            is_claim = ROOT
          }
          NOT = {
            is_core = ROOT
          }
          has_discovered = ROOT
        }
        add_claim = ROOT
      }
    }
  }
  if = {
    limit = {
      has_church_aspect = th_occult_telepathy_rune_aspect
    }
    add_dip_power = 25
    add_country_modifier = {
      name = th_occult_telepathy_rune_aspect_mod
      duration = 1825
    }
  }
  if = {
    limit = {
      has_church_aspect = th_occult_psionic_connection_rune_aspect
    }
    add_estate_influence_modifier = {
      estate = all
      influence = -10
      duration = 1825
      desc = TH_OCCULT_PSIONIC_CONNECTION_INF
      short = yes
    }
    if = {
      limit = {
        has_estate = estate_yama
      }
      add_estate_influence_modifier = {
        estate = estate_yama
        influence = 10
        duration = 1825
        desc = TH_OCCULT_CANNOT_BE_MANIPULATED
      }
    }
  }
  if = {
    limit = {
      has_church_aspect = th_occult_mind_control_rune_aspect
    }
    custom_tooltip = th_occult_reduce_autonomy_tt
    hidden_effect = {
      every_owned_province = {
        add_local_autonomy_no_authority_effect = -10
      }
    }
    add_absolutism = 5
  }
}
th_unleash_rune_effect_mil = {
  if = {
    limit = {
      has_church_aspect = th_occult_esper_resilience_rune_aspect
    }
    custom_tooltip = th_occult_no_mil_penalty_tt
    add_church_power = 25
    if = {
      limit = {
        has_estate = estate_nobles
      }
      add_estate_loyalty = {
        estate = estate_nobles
        loyalty = 5
      }
    }
    if = {
      limit = {
        has_estate = estate_rajput
      }
      add_estate_loyalty = {
        estate = estate_rajput
        loyalty = 5
      }
    }
    if = {
      limit = {
        has_estate = estate_maratha
      }
      add_estate_loyalty = {
        estate = estate_maratha
        loyalty = 5
      }
    }
    if = {
      limit = {
        has_estate = estate_great_tengu
      }
      add_estate_loyalty = {
        estate = estate_great_tengu
        loyalty = 5
      }
    }
  }
  if = {
    limit = {
      has_church_aspect = th_occult_kryokinesis_ice_block_rune_aspect
    }
    add_country_modifier = {
      name = th_occult_defensiveness_buff
      duration = 1825
    }
  }
  if = {
    limit = {
      has_church_aspect = th_occult_hydrokinesis_tide_storm_rune_aspect
    }
    create_admiral = {
      tradition = 60
    }
    add_navy_tradition = 10
  }
  if = {
    limit = {
      has_church_aspect = th_occult_pyrokinesis_explosive_sign_rune_aspect
    }
    add_mil_power = 25
    add_country_modifier = {
      name = th_occult_discipline_buff
      duration = 1825
    }
  }
  if = {
    limit = {
      has_church_aspect = th_occult_neurokinesis_motivation_rune_aspect
    }
    create_general = {
      tradition = 60
    }
    add_army_tradition = 10
  }
  if = {
    limit = {
      has_church_aspect = th_occult_psychokinesis_doppleganger_rune_aspect
    }
    add_manpower = 4
    add_yearly_manpower = 1
    add_yearly_sailors = 1
  }
}
th_unleash_rune_effect = {
  if = {
    limit = {
      has_country_flag = th_selected_rune_of_adm
    }
    th_unleash_rune_effect_adm = yes
  }
  if = {
    limit = {
      has_country_flag = th_selected_rune_of_dip
    }
    th_unleash_rune_effect_dip = yes
  }
  if = {
    limit = {
      has_country_flag = th_selected_rune_of_mil
    }
    th_unleash_rune_effect_mil = yes
  }
  if = {
    limit = {
      has_country_flag = th_selected_rune_of_adm
      NOT = {
        has_church_aspect = th_occult_esper_wisdom_aspect
      }
    }
    add_country_modifier = {
      name = th_occult_rune_power_drained_adm
      duration = 1825
    }
  }
  if = {
    limit = {
      has_country_flag = th_selected_rune_of_dip
      NOT = {
        has_church_aspect = th_occult_esper_knowledge_rune_aspect
      }
    }
    add_country_modifier = {
      name = th_occult_rune_power_drained_dip
      duration = 1825
    }
  }
  if = {
    limit = {
      has_country_flag = th_selected_rune_of_mil
      NOT = {
        has_church_aspect = th_occult_esper_resilience_rune_aspect
      }
    }
    add_country_modifier = {
      name = th_occult_rune_power_drained_mil
      duration = 1825
    }
  }
}
th_cast_spell = {
  custom_tooltip = th_cast_spell_tt
  if = {
    limit = {
      check_variable = {
        which = th_occult_rune_cost
        value = 3
      }
    }
    add_church_power = -100
  }
  if = {
    limit = {
      check_variable = {
        which = th_occult_rune_cost
        value = 2
      }
      NOT = {
        check_variable = {
          which = th_occult_rune_cost
          value = 3
        }
      }
    }
    add_church_power = -50
  }
  th_unleash_rune_effect = yes
  hidden_effect = {
    set_variable = {
      which = th_occult_rune_cost
      value = 0
    }
    th_remove_all_occult_runes = yes
  }
}
th_convert_province_to_secondary_religion = {
  owner = {
    trigger_switch = {
      on_trigger = secondary_religion
      catholic = {
        prev = {
          change_religion = catholic
        }
      }
      anglican = {
        prev = {
          change_religion = anglican
        }
      }
      hussite = {
        prev = {
          change_religion = hussite
        }
      }
      protestant = {
        prev = {
          change_religion = protestant
        }
      }
      reformed = {
        prev = {
          change_religion = reformed
        }
      }
      orthodox = {
        prev = {
          change_religion = orthodox
        }
      }
      coptic = {
        prev = {
          change_religion = coptic
        }
      }
      sunni = {
        prev = {
          change_religion = sunni
        }
      }
      shiite = {
        prev = {
          change_religion = shiite
        }
      }
      ibadi = {
        prev = {
          change_religion = ibadi
        }
      }
      buddhism = {
        prev = {
          change_religion = buddhism
        }
      }
      vajrayana = {
        prev = {
          change_religion = vajrayana
        }
      }
      mahayana = {
        prev = {
          change_religion = mahayana
        }
      }
      confucianism = {
        prev = {
          change_religion = confucianism
        }
      }
      shinto = {
        prev = {
          change_religion = shinto
        }
      }
      hinduism = {
        prev = {
          change_religion = hinduism
        }
      }
      sikhism = {
        prev = {
          change_religion = sikhism
        }
      }
      animism = {
        prev = {
          change_religion = animism
        }
      }
      shamanism = {
        prev = {
          change_religion = shamanism
        }
      }
      totemism = {
        prev = {
          change_religion = totemism
        }
      }
      inti = {
        prev = {
          change_religion = inti
        }
      }
      nahuatl = {
        prev = {
          change_religion = nahuatl
        }
      }
      mesoamerican_religion = {
        prev = {
          change_religion = mesoamerican_religion
        }
      }
      norse_pagan_reformed = {
        prev = {
          change_religion = norse_pagan_reformed
        }
      }
      tengri_pagan_reformed = {
        prev = {
          change_religion = tengri_pagan_reformed
        }
      }
      dreamtime = {
        prev = {
          change_religion = dreamtime
        }
      }
      jewish = {
        prev = {
          change_religion = jewish
        }
      }
      zoroastrian = {
        prev = {
          change_religion = zoroastrian
        }
      }
      th_hakureishinto = {
        prev = {
          change_religion = th_hakureishinto
        }
      }
      th_taoist = {
        prev = {
          change_religion = th_taoist
        }
      }
      th_buddhist = {
        prev = {
          change_religion = th_buddhist
        }
      }
      th_moriyashinto = {
        prev = {
          change_religion = th_moriyashinto
        }
      }
      th_oldhakurei = {
        prev = {
          change_religion = th_oldhakurei
        }
      }
      th_shinkism = {
        prev = {
          change_religion = th_shinkism
        }
      }
      th_scientistic = {
        prev = {
          change_religion = th_scientistic
        }
      }
      th_occultism = {
        prev = {
          change_religion = th_occultism
        }
      }
      th_lunarian_religion = {
        prev = {
          change_religion = th_lunarian_religion
        }
      }
      th_gensokirishitan = {
        prev = {
          change_religion = th_gensokirishitan
        }
      }
      th_scarlet_christians = {
        prev = {
          change_religion = th_scarlet_christians
        }
      }
      th_alukhuat = {
        prev = {
          change_religion = th_alukhuat
        }
      }
    }
  }
}